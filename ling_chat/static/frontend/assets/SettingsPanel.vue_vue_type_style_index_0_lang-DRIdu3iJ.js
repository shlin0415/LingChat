import{p as et,d as L,r as k,o as re,q as N,a as Qt,c as E,b as h,h as S,s as Ge,v as _t,F as V,m as oe,n as Se,x as se,i as Y,e as ie,k as g,y as ye,z as Xt,j as q,A as le,B as Yt,C as wt,D as j,E as B,t as R,G as Ie,H as Zt,f as _,I as St,J as Je,K as Z,w,L as rt}from"./index-DYr4VmSJ.js";import{a as F,S as en,_ as tn}from"./StarField-DeMKNpWD.js";const z=et("ui",{state:()=>({showCharacterTitle:"Lovely You",showCharacterSubtitle:"Bilibili",showCharacterEmotion:"",showSettings:!1,currentSettingsTab:"text",typeWriterSpeed:50,enableChatEffectSound:!0,currentBackground:"@/assets/images/default_bg.jpg",currentBackgroundEffect:"StarField",currentAvatarAudio:"None",characterVolume:80,backgroundVolume:80,bubbleVolume:80,autoMode:!1}),actions:{toggleSettings(t){this.showSettings=t},setSettingsTab(t){this.currentSettingsTab=t}}}),nn={currentScene:"none",avatar:{character_id:0,emotion:"正常",character_name:"钦灵",character_subtitle:"Slime Studio",user_name:"Lovely You",user_subtitle:"Bibilibi",think_message:"灵灵正在思考中",originEmotion:"",scale:1,offset:0,bubble_top:5,bubble_left:20},currentLine:"",currentStatus:"input",dialogHistory:[]};function kt(t,e){return function(){return t.apply(e,arguments)}}const{toString:sn}=Object.prototype,{getPrototypeOf:tt}=Object,{iterator:De,toStringTag:Ct}=Symbol,Ne=(t=>e=>{const n=sn.call(e);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),ee=t=>(t=t.toLowerCase(),e=>Ne(e)===t),Le=t=>e=>typeof e===t,{isArray:ge}=Array,we=Le("undefined");function ke(t){return t!==null&&!we(t)&&t.constructor!==null&&!we(t.constructor)&&W(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const Et=ee("ArrayBuffer");function rn(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&Et(t.buffer),e}const an=Le("string"),W=Le("function"),xt=Le("number"),Ce=t=>t!==null&&typeof t=="object",on=t=>t===!0||t===!1,Re=t=>{if(Ne(t)!=="object")return!1;const e=tt(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Ct in t)&&!(De in t)},ln=t=>{if(!Ce(t)||ke(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},cn=ee("Date"),un=ee("File"),dn=ee("Blob"),fn=ee("FileList"),hn=t=>Ce(t)&&W(t.pipe),pn=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||W(t.append)&&((e=Ne(t))==="formdata"||e==="object"&&W(t.toString)&&t.toString()==="[object FormData]"))},mn=ee("URLSearchParams"),[gn,vn,bn,yn]=["ReadableStream","Request","Response","Headers"].map(ee),_n=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Ee(t,e,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let s,r;if(typeof t!="object"&&(t=[t]),ge(t))for(s=0,r=t.length;s<r;s++)e.call(null,t[s],s,t);else{if(ke(t))return;const o=n?Object.getOwnPropertyNames(t):Object.keys(t),a=o.length;let i;for(s=0;s<a;s++)i=o[s],e.call(null,t[i],i,t)}}function At(t,e){if(ke(t))return null;e=e.toLowerCase();const n=Object.keys(t);let s=n.length,r;for(;s-- >0;)if(r=n[s],e===r.toLowerCase())return r;return null}const ue=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Tt=t=>!we(t)&&t!==ue;function We(){const{caseless:t}=Tt(this)&&this||{},e={},n=(s,r)=>{const o=t&&At(e,r)||r;Re(e[o])&&Re(s)?e[o]=We(e[o],s):Re(s)?e[o]=We({},s):ge(s)?e[o]=s.slice():e[o]=s};for(let s=0,r=arguments.length;s<r;s++)arguments[s]&&Ee(arguments[s],n);return e}const wn=(t,e,n,{allOwnKeys:s}={})=>(Ee(e,(r,o)=>{n&&W(r)?t[o]=kt(r,n):t[o]=r},{allOwnKeys:s}),t),Sn=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),kn=(t,e,n,s)=>{t.prototype=Object.create(e.prototype,s),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},Cn=(t,e,n,s)=>{let r,o,a;const i={};if(e=e||{},t==null)return e;do{for(r=Object.getOwnPropertyNames(t),o=r.length;o-- >0;)a=r[o],(!s||s(a,t,e))&&!i[a]&&(e[a]=t[a],i[a]=!0);t=n!==!1&&tt(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},En=(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const s=t.indexOf(e,n);return s!==-1&&s===n},xn=t=>{if(!t)return null;if(ge(t))return t;let e=t.length;if(!xt(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},An=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&tt(Uint8Array)),Tn=(t,e)=>{const s=(t&&t[De]).call(t);let r;for(;(r=s.next())&&!r.done;){const o=r.value;e.call(t,o[0],o[1])}},Rn=(t,e)=>{let n;const s=[];for(;(n=t.exec(e))!==null;)s.push(n);return s},$n=ee("HTMLFormElement"),On=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,s,r){return s.toUpperCase()+r}),at=(({hasOwnProperty:t})=>(e,n)=>t.call(e,n))(Object.prototype),Bn=ee("RegExp"),Rt=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),s={};Ee(n,(r,o)=>{let a;(a=e(r,o,t))!==!1&&(s[o]=a||r)}),Object.defineProperties(t,s)},In=t=>{Rt(t,(e,n)=>{if(W(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const s=t[n];if(W(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},Pn=(t,e)=>{const n={},s=r=>{r.forEach(o=>{n[o]=!0})};return ge(t)?s(t):s(String(t).split(e)),n},Mn=()=>{},Dn=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function Nn(t){return!!(t&&W(t.append)&&t[Ct]==="FormData"&&t[De])}const Ln=t=>{const e=new Array(10),n=(s,r)=>{if(Ce(s)){if(e.indexOf(s)>=0)return;if(ke(s))return s;if(!("toJSON"in s)){e[r]=s;const o=ge(s)?[]:{};return Ee(s,(a,i)=>{const d=n(a,r+1);!we(d)&&(o[i]=d)}),e[r]=void 0,o}}return s};return n(t,0)},Fn=ee("AsyncFunction"),Un=t=>t&&(Ce(t)||W(t))&&W(t.then)&&W(t.catch),$t=((t,e)=>t?setImmediate:e?((n,s)=>(ue.addEventListener("message",({source:r,data:o})=>{r===ue&&o===n&&s.length&&s.shift()()},!1),r=>{s.push(r),ue.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",W(ue.postMessage)),jn=typeof queueMicrotask<"u"?queueMicrotask.bind(ue):typeof process<"u"&&process.nextTick||$t,Vn=t=>t!=null&&W(t[De]),c={isArray:ge,isArrayBuffer:Et,isBuffer:ke,isFormData:pn,isArrayBufferView:rn,isString:an,isNumber:xt,isBoolean:on,isObject:Ce,isPlainObject:Re,isEmptyObject:ln,isReadableStream:gn,isRequest:vn,isResponse:bn,isHeaders:yn,isUndefined:we,isDate:cn,isFile:un,isBlob:dn,isRegExp:Bn,isFunction:W,isStream:hn,isURLSearchParams:mn,isTypedArray:An,isFileList:fn,forEach:Ee,merge:We,extend:wn,trim:_n,stripBOM:Sn,inherits:kn,toFlatObject:Cn,kindOf:Ne,kindOfTest:ee,endsWith:En,toArray:xn,forEachEntry:Tn,matchAll:Rn,isHTMLForm:$n,hasOwnProperty:at,hasOwnProp:at,reduceDescriptors:Rt,freezeMethods:In,toObjectSet:Pn,toCamelCase:On,noop:Mn,toFiniteNumber:Dn,findKey:At,global:ue,isContextDefined:Tt,isSpecCompliantForm:Nn,toJSONObject:Ln,isAsyncFn:Fn,isThenable:Un,setImmediate:$t,asap:jn,isIterable:Vn};function x(t,e,n,s,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),s&&(this.request=s),r&&(this.response=r,this.status=r.status?r.status:null)}c.inherits(x,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:c.toJSONObject(this.config),code:this.code,status:this.status}}});const Ot=x.prototype,Bt={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{Bt[t]={value:t}});Object.defineProperties(x,Bt);Object.defineProperty(Ot,"isAxiosError",{value:!0});x.from=(t,e,n,s,r,o)=>{const a=Object.create(Ot);return c.toFlatObject(t,a,function(d){return d!==Error.prototype},i=>i!=="isAxiosError"),x.call(a,t.message,e,n,s,r),a.cause=t,a.name=t.name,o&&Object.assign(a,o),a};const Hn=null;function Ke(t){return c.isPlainObject(t)||c.isArray(t)}function It(t){return c.endsWith(t,"[]")?t.slice(0,-2):t}function ot(t,e,n){return t?t.concat(e).map(function(r,o){return r=It(r),!n&&o?"["+r+"]":r}).join(n?".":""):e}function zn(t){return c.isArray(t)&&!t.some(Ke)}const qn=c.toFlatObject(c,{},null,function(e){return/^is[A-Z]/.test(e)});function Fe(t,e,n){if(!c.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,n=c.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(b,l){return!c.isUndefined(l[b])});const s=n.metaTokens,r=n.visitor||p,o=n.dots,a=n.indexes,d=(n.Blob||typeof Blob<"u"&&Blob)&&c.isSpecCompliantForm(e);if(!c.isFunction(r))throw new TypeError("visitor must be a function");function f(u){if(u===null)return"";if(c.isDate(u))return u.toISOString();if(c.isBoolean(u))return u.toString();if(!d&&c.isBlob(u))throw new x("Blob is not supported. Use a Buffer instead.");return c.isArrayBuffer(u)||c.isTypedArray(u)?d&&typeof Blob=="function"?new Blob([u]):Buffer.from(u):u}function p(u,b,l){let C=u;if(u&&!l&&typeof u=="object"){if(c.endsWith(b,"{}"))b=s?b:b.slice(0,-2),u=JSON.stringify(u);else if(c.isArray(u)&&zn(u)||(c.isFileList(u)||c.endsWith(b,"[]"))&&(C=c.toArray(u)))return b=It(b),C.forEach(function($,X){!(c.isUndefined($)||$===null)&&e.append(a===!0?ot([b],X,o):a===null?b:b+"[]",f($))}),!1}return Ke(u)?!0:(e.append(ot(l,b,o),f(u)),!1)}const m=[],v=Object.assign(qn,{defaultVisitor:p,convertValue:f,isVisitable:Ke});function y(u,b){if(!c.isUndefined(u)){if(m.indexOf(u)!==-1)throw Error("Circular reference detected in "+b.join("."));m.push(u),c.forEach(u,function(C,A){(!(c.isUndefined(C)||C===null)&&r.call(e,C,c.isString(A)?A.trim():A,b,v))===!0&&y(C,b?b.concat(A):[A])}),m.pop()}}if(!c.isObject(t))throw new TypeError("data must be an object");return y(t),e}function it(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function nt(t,e){this._pairs=[],t&&Fe(t,this,e)}const Pt=nt.prototype;Pt.append=function(e,n){this._pairs.push([e,n])};Pt.toString=function(e){const n=e?function(s){return e.call(this,s,it)}:it;return this._pairs.map(function(r){return n(r[0])+"="+n(r[1])},"").join("&")};function Gn(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Mt(t,e,n){if(!e)return t;const s=n&&n.encode||Gn;c.isFunction(n)&&(n={serialize:n});const r=n&&n.serialize;let o;if(r?o=r(e,n):o=c.isURLSearchParams(e)?e.toString():new nt(e,n).toString(s),o){const a=t.indexOf("#");a!==-1&&(t=t.slice(0,a)),t+=(t.indexOf("?")===-1?"?":"&")+o}return t}class lt{constructor(){this.handlers=[]}use(e,n,s){return this.handlers.push({fulfilled:e,rejected:n,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){c.forEach(this.handlers,function(s){s!==null&&e(s)})}}const Dt={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Jn=typeof URLSearchParams<"u"?URLSearchParams:nt,Wn=typeof FormData<"u"?FormData:null,Kn=typeof Blob<"u"?Blob:null,Qn={isBrowser:!0,classes:{URLSearchParams:Jn,FormData:Wn,Blob:Kn},protocols:["http","https","file","blob","url","data"]},st=typeof window<"u"&&typeof document<"u",Qe=typeof navigator=="object"&&navigator||void 0,Xn=st&&(!Qe||["ReactNative","NativeScript","NS"].indexOf(Qe.product)<0),Yn=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Zn=st&&window.location.href||"http://localhost",es=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:st,hasStandardBrowserEnv:Xn,hasStandardBrowserWebWorkerEnv:Yn,navigator:Qe,origin:Zn},Symbol.toStringTag,{value:"Module"})),H={...es,...Qn};function ts(t,e){return Fe(t,new H.classes.URLSearchParams,{visitor:function(n,s,r,o){return H.isNode&&c.isBuffer(n)?(this.append(s,n.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)},...e})}function ns(t){return c.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function ss(t){const e={},n=Object.keys(t);let s;const r=n.length;let o;for(s=0;s<r;s++)o=n[s],e[o]=t[o];return e}function Nt(t){function e(n,s,r,o){let a=n[o++];if(a==="__proto__")return!0;const i=Number.isFinite(+a),d=o>=n.length;return a=!a&&c.isArray(r)?r.length:a,d?(c.hasOwnProp(r,a)?r[a]=[r[a],s]:r[a]=s,!i):((!r[a]||!c.isObject(r[a]))&&(r[a]=[]),e(n,s,r[a],o)&&c.isArray(r[a])&&(r[a]=ss(r[a])),!i)}if(c.isFormData(t)&&c.isFunction(t.entries)){const n={};return c.forEachEntry(t,(s,r)=>{e(ns(s),r,n,0)}),n}return null}function rs(t,e,n){if(c.isString(t))try{return(e||JSON.parse)(t),c.trim(t)}catch(s){if(s.name!=="SyntaxError")throw s}return(n||JSON.stringify)(t)}const xe={transitional:Dt,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const s=n.getContentType()||"",r=s.indexOf("application/json")>-1,o=c.isObject(e);if(o&&c.isHTMLForm(e)&&(e=new FormData(e)),c.isFormData(e))return r?JSON.stringify(Nt(e)):e;if(c.isArrayBuffer(e)||c.isBuffer(e)||c.isStream(e)||c.isFile(e)||c.isBlob(e)||c.isReadableStream(e))return e;if(c.isArrayBufferView(e))return e.buffer;if(c.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let i;if(o){if(s.indexOf("application/x-www-form-urlencoded")>-1)return ts(e,this.formSerializer).toString();if((i=c.isFileList(e))||s.indexOf("multipart/form-data")>-1){const d=this.env&&this.env.FormData;return Fe(i?{"files[]":e}:e,d&&new d,this.formSerializer)}}return o||r?(n.setContentType("application/json",!1),rs(e)):e}],transformResponse:[function(e){const n=this.transitional||xe.transitional,s=n&&n.forcedJSONParsing,r=this.responseType==="json";if(c.isResponse(e)||c.isReadableStream(e))return e;if(e&&c.isString(e)&&(s&&!this.responseType||r)){const a=!(n&&n.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(i){if(a)throw i.name==="SyntaxError"?x.from(i,x.ERR_BAD_RESPONSE,this,null,this.response):i}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:H.classes.FormData,Blob:H.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};c.forEach(["delete","get","head","post","put","patch"],t=>{xe.headers[t]={}});const as=c.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),os=t=>{const e={};let n,s,r;return t&&t.split(`
`).forEach(function(a){r=a.indexOf(":"),n=a.substring(0,r).trim().toLowerCase(),s=a.substring(r+1).trim(),!(!n||e[n]&&as[n])&&(n==="set-cookie"?e[n]?e[n].push(s):e[n]=[s]:e[n]=e[n]?e[n]+", "+s:s)}),e},ct=Symbol("internals");function be(t){return t&&String(t).trim().toLowerCase()}function $e(t){return t===!1||t==null?t:c.isArray(t)?t.map($e):String(t)}function is(t){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=n.exec(t);)e[s[1]]=s[2];return e}const ls=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function Ve(t,e,n,s,r){if(c.isFunction(s))return s.call(this,e,n);if(r&&(e=n),!!c.isString(e)){if(c.isString(s))return e.indexOf(s)!==-1;if(c.isRegExp(s))return s.test(e)}}function cs(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,s)=>n.toUpperCase()+s)}function us(t,e){const n=c.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(t,s+n,{value:function(r,o,a){return this[s].call(this,e,r,o,a)},configurable:!0})})}let K=class{constructor(e){e&&this.set(e)}set(e,n,s){const r=this;function o(i,d,f){const p=be(d);if(!p)throw new Error("header name must be a non-empty string");const m=c.findKey(r,p);(!m||r[m]===void 0||f===!0||f===void 0&&r[m]!==!1)&&(r[m||d]=$e(i))}const a=(i,d)=>c.forEach(i,(f,p)=>o(f,p,d));if(c.isPlainObject(e)||e instanceof this.constructor)a(e,n);else if(c.isString(e)&&(e=e.trim())&&!ls(e))a(os(e),n);else if(c.isObject(e)&&c.isIterable(e)){let i={},d,f;for(const p of e){if(!c.isArray(p))throw TypeError("Object iterator must return a key-value pair");i[f=p[0]]=(d=i[f])?c.isArray(d)?[...d,p[1]]:[d,p[1]]:p[1]}a(i,n)}else e!=null&&o(n,e,s);return this}get(e,n){if(e=be(e),e){const s=c.findKey(this,e);if(s){const r=this[s];if(!n)return r;if(n===!0)return is(r);if(c.isFunction(n))return n.call(this,r,s);if(c.isRegExp(n))return n.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=be(e),e){const s=c.findKey(this,e);return!!(s&&this[s]!==void 0&&(!n||Ve(this,this[s],s,n)))}return!1}delete(e,n){const s=this;let r=!1;function o(a){if(a=be(a),a){const i=c.findKey(s,a);i&&(!n||Ve(s,s[i],i,n))&&(delete s[i],r=!0)}}return c.isArray(e)?e.forEach(o):o(e),r}clear(e){const n=Object.keys(this);let s=n.length,r=!1;for(;s--;){const o=n[s];(!e||Ve(this,this[o],o,e,!0))&&(delete this[o],r=!0)}return r}normalize(e){const n=this,s={};return c.forEach(this,(r,o)=>{const a=c.findKey(s,o);if(a){n[a]=$e(r),delete n[o];return}const i=e?cs(o):String(o).trim();i!==o&&delete n[o],n[i]=$e(r),s[i]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return c.forEach(this,(s,r)=>{s!=null&&s!==!1&&(n[r]=e&&c.isArray(s)?s.join(", "):s)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const s=new this(e);return n.forEach(r=>s.set(r)),s}static accessor(e){const s=(this[ct]=this[ct]={accessors:{}}).accessors,r=this.prototype;function o(a){const i=be(a);s[i]||(us(r,a),s[i]=!0)}return c.isArray(e)?e.forEach(o):o(e),this}};K.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);c.reduceDescriptors(K.prototype,({value:t},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(s){this[n]=s}}});c.freezeMethods(K);function He(t,e){const n=this||xe,s=e||n,r=K.from(s.headers);let o=s.data;return c.forEach(t,function(i){o=i.call(n,o,r.normalize(),e?e.status:void 0)}),r.normalize(),o}function Lt(t){return!!(t&&t.__CANCEL__)}function ve(t,e,n){x.call(this,t??"canceled",x.ERR_CANCELED,e,n),this.name="CanceledError"}c.inherits(ve,x,{__CANCEL__:!0});function Ft(t,e,n){const s=n.config.validateStatus;!n.status||!s||s(n.status)?t(n):e(new x("Request failed with status code "+n.status,[x.ERR_BAD_REQUEST,x.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function ds(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function fs(t,e){t=t||10;const n=new Array(t),s=new Array(t);let r=0,o=0,a;return e=e!==void 0?e:1e3,function(d){const f=Date.now(),p=s[o];a||(a=f),n[r]=d,s[r]=f;let m=o,v=0;for(;m!==r;)v+=n[m++],m=m%t;if(r=(r+1)%t,r===o&&(o=(o+1)%t),f-a<e)return;const y=p&&f-p;return y?Math.round(v*1e3/y):void 0}}function hs(t,e){let n=0,s=1e3/e,r,o;const a=(f,p=Date.now())=>{n=p,r=null,o&&(clearTimeout(o),o=null),t(...f)};return[(...f)=>{const p=Date.now(),m=p-n;m>=s?a(f,p):(r=f,o||(o=setTimeout(()=>{o=null,a(r)},s-m)))},()=>r&&a(r)]}const Pe=(t,e,n=3)=>{let s=0;const r=fs(50,250);return hs(o=>{const a=o.loaded,i=o.lengthComputable?o.total:void 0,d=a-s,f=r(d),p=a<=i;s=a;const m={loaded:a,total:i,progress:i?a/i:void 0,bytes:d,rate:f||void 0,estimated:f&&i&&p?(i-a)/f:void 0,event:o,lengthComputable:i!=null,[e?"download":"upload"]:!0};t(m)},n)},ut=(t,e)=>{const n=t!=null;return[s=>e[0]({lengthComputable:n,total:t,loaded:s}),e[1]]},dt=t=>(...e)=>c.asap(()=>t(...e)),ps=H.hasStandardBrowserEnv?((t,e)=>n=>(n=new URL(n,H.origin),t.protocol===n.protocol&&t.host===n.host&&(e||t.port===n.port)))(new URL(H.origin),H.navigator&&/(msie|trident)/i.test(H.navigator.userAgent)):()=>!0,ms=H.hasStandardBrowserEnv?{write(t,e,n,s,r,o){const a=[t+"="+encodeURIComponent(e)];c.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),c.isString(s)&&a.push("path="+s),c.isString(r)&&a.push("domain="+r),o===!0&&a.push("secure"),document.cookie=a.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function gs(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function vs(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function Ut(t,e,n){let s=!gs(e);return t&&(s||n==!1)?vs(t,e):e}const ft=t=>t instanceof K?{...t}:t;function he(t,e){e=e||{};const n={};function s(f,p,m,v){return c.isPlainObject(f)&&c.isPlainObject(p)?c.merge.call({caseless:v},f,p):c.isPlainObject(p)?c.merge({},p):c.isArray(p)?p.slice():p}function r(f,p,m,v){if(c.isUndefined(p)){if(!c.isUndefined(f))return s(void 0,f,m,v)}else return s(f,p,m,v)}function o(f,p){if(!c.isUndefined(p))return s(void 0,p)}function a(f,p){if(c.isUndefined(p)){if(!c.isUndefined(f))return s(void 0,f)}else return s(void 0,p)}function i(f,p,m){if(m in e)return s(f,p);if(m in t)return s(void 0,f)}const d={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:i,headers:(f,p,m)=>r(ft(f),ft(p),m,!0)};return c.forEach(Object.keys({...t,...e}),function(p){const m=d[p]||r,v=m(t[p],e[p],p);c.isUndefined(v)&&m!==i||(n[p]=v)}),n}const jt=t=>{const e=he({},t);let{data:n,withXSRFToken:s,xsrfHeaderName:r,xsrfCookieName:o,headers:a,auth:i}=e;e.headers=a=K.from(a),e.url=Mt(Ut(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),i&&a.set("Authorization","Basic "+btoa((i.username||"")+":"+(i.password?unescape(encodeURIComponent(i.password)):"")));let d;if(c.isFormData(n)){if(H.hasStandardBrowserEnv||H.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if((d=a.getContentType())!==!1){const[f,...p]=d?d.split(";").map(m=>m.trim()).filter(Boolean):[];a.setContentType([f||"multipart/form-data",...p].join("; "))}}if(H.hasStandardBrowserEnv&&(s&&c.isFunction(s)&&(s=s(e)),s||s!==!1&&ps(e.url))){const f=r&&o&&ms.read(o);f&&a.set(r,f)}return e},bs=typeof XMLHttpRequest<"u",ys=bs&&function(t){return new Promise(function(n,s){const r=jt(t);let o=r.data;const a=K.from(r.headers).normalize();let{responseType:i,onUploadProgress:d,onDownloadProgress:f}=r,p,m,v,y,u;function b(){y&&y(),u&&u(),r.cancelToken&&r.cancelToken.unsubscribe(p),r.signal&&r.signal.removeEventListener("abort",p)}let l=new XMLHttpRequest;l.open(r.method.toUpperCase(),r.url,!0),l.timeout=r.timeout;function C(){if(!l)return;const $=K.from("getAllResponseHeaders"in l&&l.getAllResponseHeaders()),U={data:!i||i==="text"||i==="json"?l.responseText:l.response,status:l.status,statusText:l.statusText,headers:$,config:t,request:l};Ft(function(ae){n(ae),b()},function(ae){s(ae),b()},U),l=null}"onloadend"in l?l.onloadend=C:l.onreadystatechange=function(){!l||l.readyState!==4||l.status===0&&!(l.responseURL&&l.responseURL.indexOf("file:")===0)||setTimeout(C)},l.onabort=function(){l&&(s(new x("Request aborted",x.ECONNABORTED,t,l)),l=null)},l.onerror=function(){s(new x("Network Error",x.ERR_NETWORK,t,l)),l=null},l.ontimeout=function(){let X=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const U=r.transitional||Dt;r.timeoutErrorMessage&&(X=r.timeoutErrorMessage),s(new x(X,U.clarifyTimeoutError?x.ETIMEDOUT:x.ECONNABORTED,t,l)),l=null},o===void 0&&a.setContentType(null),"setRequestHeader"in l&&c.forEach(a.toJSON(),function(X,U){l.setRequestHeader(U,X)}),c.isUndefined(r.withCredentials)||(l.withCredentials=!!r.withCredentials),i&&i!=="json"&&(l.responseType=r.responseType),f&&([v,u]=Pe(f,!0),l.addEventListener("progress",v)),d&&l.upload&&([m,y]=Pe(d),l.upload.addEventListener("progress",m),l.upload.addEventListener("loadend",y)),(r.cancelToken||r.signal)&&(p=$=>{l&&(s(!$||$.type?new ve(null,t,l):$),l.abort(),l=null)},r.cancelToken&&r.cancelToken.subscribe(p),r.signal&&(r.signal.aborted?p():r.signal.addEventListener("abort",p)));const A=ds(r.url);if(A&&H.protocols.indexOf(A)===-1){s(new x("Unsupported protocol "+A+":",x.ERR_BAD_REQUEST,t));return}l.send(o||null)})},_s=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let s=new AbortController,r;const o=function(f){if(!r){r=!0,i();const p=f instanceof Error?f:this.reason;s.abort(p instanceof x?p:new ve(p instanceof Error?p.message:p))}};let a=e&&setTimeout(()=>{a=null,o(new x(`timeout ${e} of ms exceeded`,x.ETIMEDOUT))},e);const i=()=>{t&&(a&&clearTimeout(a),a=null,t.forEach(f=>{f.unsubscribe?f.unsubscribe(o):f.removeEventListener("abort",o)}),t=null)};t.forEach(f=>f.addEventListener("abort",o));const{signal:d}=s;return d.unsubscribe=()=>c.asap(i),d}},ws=function*(t,e){let n=t.byteLength;if(n<e){yield t;return}let s=0,r;for(;s<n;)r=s+e,yield t.slice(s,r),s=r},Ss=async function*(t,e){for await(const n of ks(t))yield*ws(n,e)},ks=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:n,value:s}=await e.read();if(n)break;yield s}}finally{await e.cancel()}},ht=(t,e,n,s)=>{const r=Ss(t,e);let o=0,a,i=d=>{a||(a=!0,s&&s(d))};return new ReadableStream({async pull(d){try{const{done:f,value:p}=await r.next();if(f){i(),d.close();return}let m=p.byteLength;if(n){let v=o+=m;n(v)}d.enqueue(new Uint8Array(p))}catch(f){throw i(f),f}},cancel(d){return i(d),r.return()}},{highWaterMark:2})},Ue=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Vt=Ue&&typeof ReadableStream=="function",Cs=Ue&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),Ht=(t,...e)=>{try{return!!t(...e)}catch{return!1}},Es=Vt&&Ht(()=>{let t=!1;const e=new Request(H.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),pt=64*1024,Xe=Vt&&Ht(()=>c.isReadableStream(new Response("").body)),Me={stream:Xe&&(t=>t.body)};Ue&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Me[e]&&(Me[e]=c.isFunction(t[e])?n=>n[e]():(n,s)=>{throw new x(`Response type '${e}' is not supported`,x.ERR_NOT_SUPPORT,s)})})})(new Response);const xs=async t=>{if(t==null)return 0;if(c.isBlob(t))return t.size;if(c.isSpecCompliantForm(t))return(await new Request(H.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(c.isArrayBufferView(t)||c.isArrayBuffer(t))return t.byteLength;if(c.isURLSearchParams(t)&&(t=t+""),c.isString(t))return(await Cs(t)).byteLength},As=async(t,e)=>{const n=c.toFiniteNumber(t.getContentLength());return n??xs(e)},Ts=Ue&&(async t=>{let{url:e,method:n,data:s,signal:r,cancelToken:o,timeout:a,onDownloadProgress:i,onUploadProgress:d,responseType:f,headers:p,withCredentials:m="same-origin",fetchOptions:v}=jt(t);f=f?(f+"").toLowerCase():"text";let y=_s([r,o&&o.toAbortSignal()],a),u;const b=y&&y.unsubscribe&&(()=>{y.unsubscribe()});let l;try{if(d&&Es&&n!=="get"&&n!=="head"&&(l=await As(p,s))!==0){let U=new Request(e,{method:"POST",body:s,duplex:"half"}),te;if(c.isFormData(s)&&(te=U.headers.get("content-type"))&&p.setContentType(te),U.body){const[ae,pe]=ut(l,Pe(dt(d)));s=ht(U.body,pt,ae,pe)}}c.isString(m)||(m=m?"include":"omit");const C="credentials"in Request.prototype;u=new Request(e,{...v,signal:y,method:n.toUpperCase(),headers:p.normalize().toJSON(),body:s,duplex:"half",credentials:C?m:void 0});let A=await fetch(u,v);const $=Xe&&(f==="stream"||f==="response");if(Xe&&(i||$&&b)){const U={};["status","statusText","headers"].forEach(Ae=>{U[Ae]=A[Ae]});const te=c.toFiniteNumber(A.headers.get("content-length")),[ae,pe]=i&&ut(te,Pe(dt(i),!0))||[];A=new Response(ht(A.body,pt,ae,()=>{pe&&pe(),b&&b()}),U)}f=f||"text";let X=await Me[c.findKey(Me,f)||"text"](A,t);return!$&&b&&b(),await new Promise((U,te)=>{Ft(U,te,{data:X,headers:K.from(A.headers),status:A.status,statusText:A.statusText,config:t,request:u})})}catch(C){throw b&&b(),C&&C.name==="TypeError"&&/Load failed|fetch/i.test(C.message)?Object.assign(new x("Network Error",x.ERR_NETWORK,t,u),{cause:C.cause||C}):x.from(C,C&&C.code,t,u)}}),Ye={http:Hn,xhr:ys,fetch:Ts};c.forEach(Ye,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const mt=t=>`- ${t}`,Rs=t=>c.isFunction(t)||t===null||t===!1,zt={getAdapter:t=>{t=c.isArray(t)?t:[t];const{length:e}=t;let n,s;const r={};for(let o=0;o<e;o++){n=t[o];let a;if(s=n,!Rs(n)&&(s=Ye[(a=String(n)).toLowerCase()],s===void 0))throw new x(`Unknown adapter '${a}'`);if(s)break;r[a||"#"+o]=s}if(!s){const o=Object.entries(r).map(([i,d])=>`adapter ${i} `+(d===!1?"is not supported by the environment":"is not available in the build"));let a=e?o.length>1?`since :
`+o.map(mt).join(`
`):" "+mt(o[0]):"as no adapter specified";throw new x("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return s},adapters:Ye};function ze(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new ve(null,t)}function gt(t){return ze(t),t.headers=K.from(t.headers),t.data=He.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),zt.getAdapter(t.adapter||xe.adapter)(t).then(function(s){return ze(t),s.data=He.call(t,t.transformResponse,s),s.headers=K.from(s.headers),s},function(s){return Lt(s)||(ze(t),s&&s.response&&(s.response.data=He.call(t,t.transformResponse,s.response),s.response.headers=K.from(s.response.headers))),Promise.reject(s)})}const qt="1.11.0",je={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{je[t]=function(s){return typeof s===t||"a"+(e<1?"n ":" ")+t}});const vt={};je.transitional=function(e,n,s){function r(o,a){return"[Axios v"+qt+"] Transitional option '"+o+"'"+a+(s?". "+s:"")}return(o,a,i)=>{if(e===!1)throw new x(r(a," has been removed"+(n?" in "+n:"")),x.ERR_DEPRECATED);return n&&!vt[a]&&(vt[a]=!0,console.warn(r(a," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(o,a,i):!0}};je.spelling=function(e){return(n,s)=>(console.warn(`${s} is likely a misspelling of ${e}`),!0)};function $s(t,e,n){if(typeof t!="object")throw new x("options must be an object",x.ERR_BAD_OPTION_VALUE);const s=Object.keys(t);let r=s.length;for(;r-- >0;){const o=s[r],a=e[o];if(a){const i=t[o],d=i===void 0||a(i,o,t);if(d!==!0)throw new x("option "+o+" must be "+d,x.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new x("Unknown option "+o,x.ERR_BAD_OPTION)}}const Oe={assertOptions:$s,validators:je},ne=Oe.validators;let de=class{constructor(e){this.defaults=e||{},this.interceptors={request:new lt,response:new lt}}async request(e,n){try{return await this._request(e,n)}catch(s){if(s instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const o=r.stack?r.stack.replace(/^.+\n/,""):"";try{s.stack?o&&!String(s.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+o):s.stack=o}catch{}}throw s}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=he(this.defaults,n);const{transitional:s,paramsSerializer:r,headers:o}=n;s!==void 0&&Oe.assertOptions(s,{silentJSONParsing:ne.transitional(ne.boolean),forcedJSONParsing:ne.transitional(ne.boolean),clarifyTimeoutError:ne.transitional(ne.boolean)},!1),r!=null&&(c.isFunction(r)?n.paramsSerializer={serialize:r}:Oe.assertOptions(r,{encode:ne.function,serialize:ne.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),Oe.assertOptions(n,{baseUrl:ne.spelling("baseURL"),withXsrfToken:ne.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let a=o&&c.merge(o.common,o[n.method]);o&&c.forEach(["delete","get","head","post","put","patch","common"],u=>{delete o[u]}),n.headers=K.concat(a,o);const i=[];let d=!0;this.interceptors.request.forEach(function(b){typeof b.runWhen=="function"&&b.runWhen(n)===!1||(d=d&&b.synchronous,i.unshift(b.fulfilled,b.rejected))});const f=[];this.interceptors.response.forEach(function(b){f.push(b.fulfilled,b.rejected)});let p,m=0,v;if(!d){const u=[gt.bind(this),void 0];for(u.unshift(...i),u.push(...f),v=u.length,p=Promise.resolve(n);m<v;)p=p.then(u[m++],u[m++]);return p}v=i.length;let y=n;for(m=0;m<v;){const u=i[m++],b=i[m++];try{y=u(y)}catch(l){b.call(this,l);break}}try{p=gt.call(this,y)}catch(u){return Promise.reject(u)}for(m=0,v=f.length;m<v;)p=p.then(f[m++],f[m++]);return p}getUri(e){e=he(this.defaults,e);const n=Ut(e.baseURL,e.url,e.allowAbsoluteUrls);return Mt(n,e.params,e.paramsSerializer)}};c.forEach(["delete","get","head","options"],function(e){de.prototype[e]=function(n,s){return this.request(he(s||{},{method:e,url:n,data:(s||{}).data}))}});c.forEach(["post","put","patch"],function(e){function n(s){return function(o,a,i){return this.request(he(i||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:o,data:a}))}}de.prototype[e]=n(),de.prototype[e+"Form"]=n(!0)});let Os=class Gt{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(o){n=o});const s=this;this.promise.then(r=>{if(!s._listeners)return;let o=s._listeners.length;for(;o-- >0;)s._listeners[o](r);s._listeners=null}),this.promise.then=r=>{let o;const a=new Promise(i=>{s.subscribe(i),o=i}).then(r);return a.cancel=function(){s.unsubscribe(o)},a},e(function(o,a,i){s.reason||(s.reason=new ve(o,a,i),n(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=s=>{e.abort(s)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new Gt(function(r){e=r}),cancel:e}}};function Bs(t){return function(n){return t.apply(null,n)}}function Is(t){return c.isObject(t)&&t.isAxiosError===!0}const Ze={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ze).forEach(([t,e])=>{Ze[e]=t});function Jt(t){const e=new de(t),n=kt(de.prototype.request,e);return c.extend(n,de.prototype,e,{allOwnKeys:!0}),c.extend(n,e,null,{allOwnKeys:!0}),n.create=function(r){return Jt(he(t,r))},n}const M=Jt(xe);M.Axios=de;M.CanceledError=ve;M.CancelToken=Os;M.isCancel=Lt;M.VERSION=qt;M.toFormData=Fe;M.AxiosError=x;M.Cancel=M.CanceledError;M.all=function(e){return Promise.all(e)};M.spread=Bs;M.isAxiosError=Is;M.mergeConfig=he;M.AxiosHeaders=K;M.formToJSON=t=>Nt(c.isHTMLForm(t)?new FormData(t):t);M.getAdapter=zt.getAdapter;M.HttpStatusCode=Ze;M.default=M;const{Axios:Oo,AxiosError:Bo,CanceledError:Io,isCancel:Po,CancelToken:Mo,VERSION:Do,all:No,Cancel:Lo,isAxiosError:Fo,spread:Uo,toFormData:jo,AxiosHeaders:Vo,HttpStatusCode:Ho,formToJSON:zo,getAdapter:qo,mergeConfig:Go}=M,Q=M.create({baseURL:"/api",timeout:3e4,headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},withCredentials:!0});Q.interceptors.request.use(t=>{t.headers=t.headers||{};const e=localStorage.getItem("token");return e&&(t.headers.Authorization=`Bearer ${e}`),t.data instanceof FormData&&(t.headers["Content-Type"]="multipart/form-data"),t},t=>Promise.reject(t));Q.interceptors.response.use(t=>{if(t.data&&t.data.code!==void 0){if(t.data.code===200)return t.data.data;{const e=new Error(t.data.message||"请求失败");return e.code=t.data.code,Promise.reject(e)}}else return t.data&&t.data.data!==void 0?t.data.data:t.data},t=>{const e=t.response?.data||{},n=e.message||t.message||"网络错误",s=new Error(n);if(s.status=t.response?.status,s.code=e.code,s.response=t.response,t.response)switch(t.response.status){case 401:window.location.href="/login";break}return Promise.reject(s)});const Ps=async t=>{try{const e=await Q.get("/v1/chat/info/init",{params:{user_id:t}});return console.log(e),e}catch(e){throw console.error("获取游戏信息错误:",e.message),e}},Ms={updateLine(t){this.currentLine=t},setGameStatus(t){this.currentStatus=t},addToDialogHistory(t){this.dialogHistory.push({...t,timestamp:Date.now()})},clearDialogHistory(){this.dialogHistory=[]},setCurrentStatus(t){this.currentStatus=t},async initializeGame(t){try{const e=await Ps(t);this.avatar.character_name=e.ai_name,this.avatar.character_subtitle=e.ai_subtitle,this.avatar.user_name=e.user_name,this.avatar.user_subtitle=e.user_subtitle,this.avatar.character_id=e.character_id,this.avatar.think_message=e.thinking_message,this.avatar.scale=e.scale,this.avatar.offset=e.offset,this.avatar.bubble_left=e.bubble_left,this.avatar.bubble_top=e.bubble_top;const n=z();return n.showCharacterTitle=e.user_name,n.showCharacterSubtitle=e.user_subtitle,e}catch(e){throw console.error("初始化游戏信息失败:",e),e}}},Ds={getCurrentLine(t){return t.currentLine},getDialogHistory(t){return t.dialogHistory},getAvatarInfo(t){return t.avatar},getGameStatus(t){return t.currentStatus},getCurrentScene(t){return t.currentScene}},G=et("game",{state:()=>nn,getters:Ds,actions:Ms}),bt="/api/v1",D={AVATAR:{BASE:`${bt}/chat/character/get_avatar`},VOICE:{BASE:`${bt}/chat/sound/get_voice`}},qe={厌恶:{animation:"none",bubbleImage:"../pictures/animation/生气.webp",bubbleClass:"angry",audio:"../audio_effects/厌恶.wav",avatar:`${D.AVATAR.BASE}/厌恶.png`},高兴:{animation:"happy-bounce",bubbleImage:"../pictures/animation/高兴.webp",bubbleClass:"happy",audio:"../audio_effects/喜悦.wav",avatar:`${D.AVATAR.BASE}/高兴.png`},担心:{animation:"none",bubbleImage:"../pictures/animation/流泪.webp",bubbleClass:"none",audio:"../audio_effects/伤心.wav",avatar:`${D.AVATAR.BASE}/担心.png`},生气:{animation:"angry-jump",bubbleImage:"../pictures/animation/生气2.webp",bubbleClass:"angry",audio:"../audio_effects/生气.wav",avatar:`${D.AVATAR.BASE}/生气.png`},紧张:{animation:"none",bubbleImage:"../pictures/animation/紧张.webp",bubbleClass:"none",audio:"../audio_effects/尴尬.wav",avatar:`${D.AVATAR.BASE}/紧张.png`},害怕:{animation:"none",bubbleImage:"../pictures/animation/惊讶.webp",bubbleClass:"none",audio:"../audio_effects/震惊.wav",avatar:`${D.AVATAR.BASE}/害怕.png`},害羞:{animation:"none",bubbleImage:"../pictures/animation/害羞.webp",bubbleClass:"shy",audio:"../audio_effects/害羞.wav",avatar:`${D.AVATAR.BASE}/害羞.png`},慌张:{animation:"none",bubbleImage:"../pictures/animation/慌乱.webp",bubbleClass:"none",audio:"../audio_effects/震惊.wav",avatar:`${D.AVATAR.BASE}/慌张.png`},认真:{animation:"serious-think",bubbleImage:"none",bubbleClass:"none",audio:"none",avatar:`${D.AVATAR.BASE}/认真.png`},无奈:{animation:"none",bubbleImage:"../pictures/animation/叹气.webp",bubbleClass:"none",audio:"../audio_effects/叹气.wav",avatar:`${D.AVATAR.BASE}/无奈.png`},兴奋:{animation:"happy-bounce",bubbleImage:"../pictures/animation/聊天.webp",bubbleClass:"none",audio:"../audio_effects/聊天.wav",avatar:`${D.AVATAR.BASE}/兴奋.png`},疑惑:{animation:"none",bubbleImage:"../pictures/animation/疑问.webp",bubbleClass:"none",audio:"../audio_effects/疑问.wav",avatar:`${D.AVATAR.BASE}/疑惑.png`},哭泣:{animation:"none",bubbleImage:"../pictures/animation/流泪.webp",bubbleClass:"none",audio:"../audio_effects/伤心.wav",avatar:`${D.AVATAR.BASE}/伤心.png`},心动:{animation:"heart-beat",bubbleImage:"../pictures/animation/心动.webp",bubbleClass:"none",audio:"../audio_effects/喜爱.wav",avatar:`${D.AVATAR.BASE}/心动.png`},调皮:{animation:"naughty-bounce",bubbleImage:"../pictures/animation/高兴.webp",bubbleClass:"none",audio:"../audio_effects/愉快.wav",avatar:`${D.AVATAR.BASE}/调皮.png`},难为情:{animation:"embarrassed-emo",bubbleImage:"../pictures/animation/难为情.webp",bubbleClass:"none",audio:"../audio_effects/察觉.wav",avatar:`${D.AVATAR.BASE}/羞耻.png`},自信:{animation:"none",bubbleImage:"../pictures/animation/高兴.webp",bubbleClass:"none",audio:"../audio_effects/愉快.wav",avatar:`${D.AVATAR.BASE}/自信.png`},惊讶:{animation:"none",bubbleImage:"../pictures/animation/惊讶.webp",bubbleClass:"none",audio:"../audio_effects/察觉.wav",avatar:`${D.AVATAR.BASE}/惊讶.png`},正常:{animation:"none",bubbleImage:"none",bubbleClass:"none",audio:"none",avatar:`${D.AVATAR.BASE}/正常.png`},AI思考:{animation:"none",bubbleImage:"../pictures/animation/AI思考.webp",bubbleClass:"none",audio:"../audio_effects/无语.wav",avatar:"none"}};class Ns{currentEmotion;animationEndHandler;DOM;constructor(e){this.DOM=e;const n=G();this.currentEmotion=n.avatar.emotion||"正常",this.animationEndHandler=this._handleAnimationEnd.bind(this),this.DOM.avatar.container.addEventListener("animationend",this.animationEndHandler)}setEmotion(e,n=!1){if(!qe[e]){console.log(`未知表情: ${e}`);return}if(this.currentEmotion===e&&!n)return;const s=qe[e];if(this._clearCurrentEffects(),s.avatar&&s.avatar!=="none")try{this.DOM.avatar.img.classList.add("loading");const r=new Image;r.onload=()=>{this.DOM.avatar.img.style.backgroundImage=`url(${r.src})`,this.DOM.avatar.img.classList.remove("loading")},r.onerror=()=>{console.log(`加载头像失败: ${s.avatar}`),this.DOM.avatar.img.classList.remove("loading"),this.DOM.avatar.img.style.backgroundImage="url(/api/v1/chat/character/get_avatar/正常.png)"};const o=Date.now();r.src=`${s.avatar}?t=${o}`}catch(r){console.error("设置表情头像时出错:",r),this.DOM.avatar.img.classList.remove("loading")}s.animation!=="none"&&(this.DOM.avatar.container.classList.remove(this.currentEmotion),this.DOM.avatar.container.classList.add(s.animation)),s.bubbleImage!=="none"&&this._showBubbleEffect(s),s.audio!=="none"&&(this.DOM.bubbleAudio.src=s.audio,this.DOM.bubbleAudio.load(),this.DOM.bubbleAudio.play()),this.currentEmotion=e}_clearCurrentEffects(){Object.values(qe).forEach(({animation:e})=>{e!=="none"&&this.DOM.avatar.container.classList.remove(e)})}_showBubbleEffect(e){const n=Date.now();e.bubbleImage!=="none"&&(this.DOM.avatar.bubble.classList.remove("show"),this.DOM.avatar.bubble.offsetWidth,this.DOM.avatar.bubble.style.backgroundImage=`url(${e.bubbleImage}?t=${n}#t=0.1)`,this.DOM.avatar.bubble.classList.add(e.bubbleClass),this.DOM.avatar.bubble.classList.add("show"),setTimeout(()=>{this.DOM.avatar.bubble.classList.remove("show"),this.DOM.avatar.bubble.classList.remove(e.bubbleClass)},2e3))}_handleAnimationEnd(){this._clearCurrentEffects(),this.DOM.avatar.container.classList.add("normal")}destroy(){this.DOM.avatar.container.removeEventListener("animationend",this.animationEndHandler)}}const Ls=L({__name:"GameAvatar",emits:["audio-ended"],setup(t,{expose:e,emit:n}){const s=G(),r=z(),o=k(null),a=k(null),i=k(null),d=k(null),f=k(null);let p=null;const m=(u,b=!1)=>{p?.setEmotion(u,b)},v=n,y=()=>{v("audio-ended")};return re(()=>{p=new Ns({avatar:{container:o.value,img:a.value,bubble:i.value},bubbleAudio:f.value}),p.setEmotion(s.avatar.emotion),N(()=>s.avatar.emotion,u=>{p?.setEmotion(u)}),N(()=>r.currentAvatarAudio,u=>{d.value&&u&&u!=="None"&&(d.value.src=`${D.VOICE.BASE}/${u}`,d.value.load(),d.value.play())}),N(()=>s.avatar.offset,u=>{a.value&&a.value.style&&(a.value.style.top=u.toString()+"px")}),N(()=>s.avatar.scale,u=>{a.value&&a.value.style&&(a.value.style.transform=`scale(${u})`)}),N(()=>s.avatar.bubble_left,u=>{i.value&&i.value.style&&(i.value.style.left=u.toString()+"%")}),N(()=>s.avatar.bubble_top,u=>{i.value&&i.value.style&&(i.value.style.top=u.toString()+"%")}),N(()=>r.characterVolume,u=>{d.value&&(d.value.volume=u/100)}),N(()=>r.bubbleVolume,u=>{f.value&&(f.value.volume=u/100)})}),Qt(()=>{p?.destroy()}),e({setEmotion:m}),(u,b)=>(S(),E("div",{ref_key:"avatarContainer",ref:o,class:"avatar-container character-animation normal"},[h("div",{ref_key:"avatarImg",ref:a,class:"avatar-img",id:"qinling"},null,512),h("div",{ref_key:"avatarBubble",ref:i,class:"bubble"},null,512),h("audio",{ref_key:"avatarAudio",ref:d,onEnded:y},null,544),h("audio",{ref_key:"bubbleAudio",ref:f},null,512)],512))}}),Fs={__name:"Rain",props:{enabled:{type:Boolean,default:!0},intensity:{type:Number,default:1,validator:t=>t>=0&&t<=2}},setup(t){const e=t,n=k(50),s=k(20),r=k([]),o=k(null),a=k(null),i=k(0),d=k(null);N(()=>e.intensity,v=>{n.value=Math.max(10,100-v*45)},{immediate:!0});const f=()=>{e.enabled&&(clearInterval(o.value),o.value=setInterval(()=>{const v={top:-100,left:`${~~(Math.random()*100)}%`,speed:10+Math.random()*10*e.intensity,size:30+Math.random()*40*e.intensity,opacity:.2+Math.random()*.5};r.value.push(v)},n.value))},p=()=>{e.enabled&&(clearInterval(a.value),a.value=setInterval(()=>{const v=r.value.filter(y=>y.top<i.value);v.forEach(y=>{y.top+=y.speed}),r.value=v},s.value))},m=()=>{d.value&&d.value.parentElement?i.value=d.value.parentElement.clientHeight:i.value=window.innerHeight};return re(()=>{Ge(()=>{m(),e.enabled&&(f(),p())}),window.addEventListener("resize",m)}),_t(()=>{clearInterval(o.value),clearInterval(a.value),window.removeEventListener("resize",m)}),N(()=>e.enabled,v=>{v?(m(),f(),p()):(clearInterval(o.value),clearInterval(a.value),r.value=[])}),(v,y)=>(S(),E("div",{class:"rain-container",ref_key:"containerRef",ref:d},[(S(!0),E(V,null,oe(r.value,(u,b)=>(S(),E("span",{class:"rain-item",key:b,style:Se({top:`${u.top}px`,left:u.left,height:`${u.size}px`,opacity:u.opacity})},null,4))),128))],512))}},Us=F(Fs,[["__scopeId","data-v-76d838e4"]]),js={__name:"GameBackground",setup(t){const e=z(),n=k(null),s=k(!0),r=k(200),o=k(.4),a=k(["rgb(173, 216, 230)","rgb(176, 224, 230)","rgb(241, 141, 252)","rgb(176, 230, 224)","rgb(173, 230, 216)"]),i=k(!1),d=k(!0),f=k(1),p=se(()=>({backgroundImage:e.currentBackground?`url(${e.currentBackground})`:"url(@/assets/images/default_bg.jpg)"}));i.value=!0;const m=v=>{console.log("Starfield ready",v)};return N(()=>e.currentBackgroundEffect,v=>{v==="Rain"&&(i.value=!0)}),(v,y)=>(S(),E(V,null,[h("div",{class:"game-background",style:Se(p.value)},null,4),g(e).currentBackgroundEffect==="StarField"?(S(),Y(en,{key:0,ref_key:"starfieldRef",ref:n,enabled:s.value,"star-count":r.value,"scroll-speed":o.value,colors:a.value,onReady:m},null,8,["enabled","star-count","scroll-speed","colors"])):ie("",!0),g(e).currentBackgroundEffect==="Rain"?(S(),Y(Us,{key:1,enabled:d.value,intensity:f.value},null,8,["enabled","intensity"])):ie("",!0)],64))}},Vs=F(js,[["__scopeId","data-v-e1a99587"]]);var fe=(t=>(t.MESSAGE="message",t.AIREPLY="reply",t.STATUS_UPDATE="status_update",t.ERROR="error",t.SCRIPT_NARRATION="script_narration",t.SCRIPT_PLAYER="script_player",t.SCRIPT_DIALOGUE="script_dialog",t.SCRIPT_BACKGROUND="script_background",t))(fe||{});class Hs{messageQueue=[];currentMessagePart=null;isProcessing=!1;constructor(){this.registerHandlers()}registerHandlers(){ye(fe.AIREPLY,e=>{console.log(e),this.handleAIReply(e)}),ye(fe.SCRIPT_NARRATION,e=>{console.log(e)})}handleAIReply(e){const n=G();try{this.handleChatMessage(e)}catch(s){console.error("处理回复消息出错:",s),n.currentStatus="input"}}handleChatMessage(e){this.messageQueue.push(e),this.isProcessing||this.continueMessage()}continueMessage(){let e=!1;return this.currentMessagePart?.isFinal?(this.resetConversationState(),this.messageQueue.length>0&&setTimeout(()=>{this.processNextMessage()},2e3)):this.messageQueue.length===0?(e=!0,console.log("后面的消息还没到，请稍等")):this.processNextMessage(),e}processNextMessage(){const e=G(),n=z();if(e.currentStatus="responding",this.isProcessing=!0,this.currentMessagePart=this.messageQueue.shift()||null,!this.currentMessagePart)return;const s=this.currentMessagePart.motionText?`${this.currentMessagePart.message}（${this.currentMessagePart.motionText}）`:this.currentMessagePart.message||"",r=this.currentMessagePart.isFinal;e.addToDialogHistory({type:"reply",content:this.currentMessagePart.message,emotion:this.currentMessagePart.emotion,audioFile:this.currentMessagePart.audioFile,isFinal:r,motionText:this.currentMessagePart.motionText,originalTag:this.currentMessagePart.originalTag}),e.currentLine=s,e.avatar.emotion=this.currentMessagePart.emotion||"正常",e.avatar.originEmotion=this.currentMessagePart.originalTag||"正常",n.currentAvatarAudio=this.currentMessagePart.audioFile||"None",n.showCharacterEmotion=e.avatar.originEmotion}sendMessage(e){const n=G();e.trim()&&(n.currentStatus="thinking",n.addToDialogHistory({type:"message",content:e}),this.messageQueue=[],this.isProcessing=!1,Xt(fe.MESSAGE,e))}resetConversationState(){const e=G();this.currentMessagePart=null,this.isProcessing=!1,e.currentStatus="input",e.currentLine=""}}const yt=new Hs;class zs{eventQueue=[];currentEvent=null;isProcessing=!1;constructor(){this.registerHandlers()}registerHandlers(){ye(fe.SCRIPT_NARRATION,e=>{console.log("收到剧本旁白事件:",e),this.addToQueue(e)}),ye(fe.SCRIPT_DIALOGUE,e=>{console.log("收到剧本对话事件:",e),this.addToQueue(e)}),ye(fe.SCRIPT_BACKGROUND,e=>{console.log("收到背景切换事件:",e),this.addToQueue(e)})}addToQueue(e){this.eventQueue.push(e),this.isProcessing||this.processNextEvent()}processNextEvent(){if(this.eventQueue.length===0){this.isProcessing=!1,this.resetConversationState();return}if(this.isProcessing=!0,this.currentEvent=this.eventQueue.shift()||null,!this.currentEvent){this.isProcessing=!1;return}switch(this.currentEvent.type){case"script_narration":this.handleNarration(this.currentEvent);break;case"script_dialogue":break;case"script_background":break;default:console.warn("未知的剧本事件类型:",this.currentEvent),this.completeCurrentEvent()}}handleNarration(e){const n=G();z(),n.currentStatus="narrating",n.currentLine=e.text}completeCurrentEvent(){this.currentEvent=null,this.processNextEvent()}continueScript(){G(),this.completeCurrentEvent()}clearQueue(){this.eventQueue=[],this.currentEvent=null,this.isProcessing=!1;const e=G();e.currentStatus="input"}getQueueState(){return{queueLength:this.eventQueue.length,isProcessing:this.isProcessing,currentEvent:this.currentEvent}}resetConversationState(){const e=G();this.isProcessing=!1,e.currentStatus="input",e.currentLine=""}}const qs=new zs,Gs=["innerHTML"],Js=L({__name:"Icon",props:{icon:{type:String,default:"character"},size:{type:Number,default:18}},emits:["click"],setup(t,{emit:e}){const n=t,s=se(()=>r[n.icon]),r={character:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 20a6 6 0 0 0-12 0"/><circle cx="12" cy="10" r="4"/><circle cx="12" cy="12" r="10"/></svg>',text:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="21" y1="10" x2="3" y2="10"/><line x1="21" y1="6" x2="3" y2="6"/><line x1="21" y1="14" x2="3" y2="14"/><line x1="21" y1="18" x2="3" y2="18"/></svg>',background:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>',sound:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 10v3M6 7v9M10 4v15M14 7v9M18 10v3"/></svg>',history:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-history-icon lucide-history"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></svg>',box:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="5" x="2" y="4" rx="2"/><path d="M4 9v9a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9"/><path d="M10 13h4"/></svg>',play:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-play-icon lucide-play"><path d="M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z"/></svg>',save:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-marked-icon lucide-book-marked"><path d="M10 2v8l3-3 3 3V2"/><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20"/></svg>',advance:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="4" y1="21" y2="14" /><line x1="4" x2="4" y1="10" y2="3" /><line x1="12" x2="12" y1="21" y2="12" /><line x1="12" x2="12" y1="8" y2="3" /><line x1="20" x2="20" y1="21" y2="16" /><line x1="20"x2="20" y1="12" y2="3" /><line x1="2" x2="6" y1="14" y2="14" /><line x1="10" x2="14" y1="8" y2="8" /><line x1="18" x2="22" y1="16" y2="16" /></svg>',close:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',schedule:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard-list-icon lucide-clipboard-list"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></svg>'};return(o,a)=>(S(),E("span",{innerHTML:s.value,style:Se(`width:${t.size}px, height:${t.size}px`),onClick:a[0]||(a[0]=i=>o.$emit("click"))},null,12,Gs))}}),Wt=F(Js,[["__scopeId","data-v-3908b06f"]]),Ws=["disabled"],Ks=L({__name:"Button",props:{type:{},disabled:{type:Boolean},icon:{},icon_size:{}},emits:["click"],setup(t,{emit:e}){return(n,s)=>(S(),E("button",{class:q(n.type),disabled:n.disabled,onClick:s[0]||(s[0]=r=>n.$emit("click"))},[n.icon?(S(),Y(Wt,{key:0,icon:n.icon,size:n.icon_size},null,8,["icon","size"])):ie("",!0),le(n.$slots,"default",{},void 0)],10,Ws))}}),I=F(Ks,[["__scopeId","data-v-07752d7f"]]),Qs={name:"GlassInput",inheritAttrs:!1,props:{modelValue:{type:String,default:""}},emits:["update:modelValue"]},Xs={class:"form-group"},Ys=["value"];function Zs(t,e,n,s,r,o){return S(),E("div",Xs,[h("input",Yt({type:"text",class:"form-control",value:n.modelValue,onInput:e[0]||(e[0]=a=>t.$emit("update:modelValue",a.target.value))},t.$attrs),null,16,Ys)])}const er=F(Qs,[["render",Zs],["__scopeId","data-v-ea73f387"]]),tr=["min","max","step","value"],nr=L({__name:"Slider",props:{value:{type:Number,require:!1},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1}},emits:["change","input"],setup(t,{emit:e}){const n=t,s=k(),r=wt();s.value=(n.min+n.max)/2;const o=se(()=>{if(r.default){const i=r.default();if(i&&i[0]&&typeof i[0].children=="string")return i[0].children.split("/")[0]||""}return""}),a=se(()=>{if(r.default){const i=r.default();if(i&&i[0]&&typeof i[0].children=="string")return i[0].children.split("/")[1]||""}return""});return(i,d)=>(S(),E("div",null,[h("span",null,[le(i.$slots,"left",{},()=>[B(R(o.value),1)])]),j(h("input",{type:"range",min:t.min,max:t.max,step:t.step,value:s.value,onInput:d[0]||(d[0]=f=>i.$emit("input",Number(s.value))),onChange:d[1]||(d[1]=f=>i.$emit("change",Number(s.value))),"onUpdate:modelValue":d[2]||(d[2]=f=>s.value=f)},null,40,tr),[[Ie,s.value]]),h("span",null,[le(i.$slots,"right",{},()=>[B(R(a.value),1)])])]))}}),Be=F(nr,[["__scopeId","data-v-c3230732"]]),sr={__name:"Text",props:{speed:{type:Number,default:0}},setup(t){const e=t,n=k(),s=wt().default()[0].children;N(()=>e.speed,()=>o(e.speed));let r;const o=a=>{clearInterval(r),n.value="";let i=0;const d=200,p=d-(a-1)/99*(d-10);r=setInterval(()=>{i<s.length?(n.value+=s.charAt(i),i++):clearInterval(r)},p)};return(a,i)=>(S(),E("div",null,[h("p",null,R(n.value),1),i[0]||(i[0]=h("span",null,null,-1))]))}},rr=F(sr,[["__scopeId","data-v-79a954ed"]]),ar=["id","checked"],or=["for"],ir=L({__name:"Toggle",props:{checked:{type:Boolean,default:!1}},emits:["change"],setup(t,{emit:e}){const n=k(),s=k();return re(()=>{n.value=Math.random().toString(36).substring(2,9)}),(r,o)=>(S(),E("div",null,[j(h("input",{type:"checkbox",id:n.value,checked:t.checked,onChange:o[0]||(o[0]=a=>r.$emit("change",s.value)),"onUpdate:modelValue":o[1]||(o[1]=a=>s.value=a)},null,40,ar),[[Zt,s.value]]),h("label",{for:n.value},[le(r.$slots,"default",{},void 0)],8,or)]))}}),_e=F(ir,[["__scopeId","data-v-2c12f9f5"]]);class lr{element;timer=null;abortController;speed;isFinished;onFinishCallback;audioContext;soundBuffers;textBuffers;soundUrls;constructor(e){this.element=e,this.timer=null,this.abortController=null,this.speed=50,this.isFinished=!1,this.onFinishCallback=null,this.audioContext=null,this.soundBuffers=[],this.textBuffers="",this.soundUrls=["../audio_effects/对话.wav"]}async initAudio(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),await this.loadSounds()}catch(e){console.warn("音频初始化失败:",e);const n=z();n.enableChatEffectSound=!1}}async loadSounds(){if(this.audioContext)try{const e=this.soundUrls.map(async n=>{const r=await(await fetch(n)).arrayBuffer();return this.audioContext.decodeAudioData(r)});this.soundBuffers=await Promise.all(e)}catch(e){console.warn("音效加载失败:",e)}}playRandomSound(){if(!z().enableChatEffectSound||!this.audioContext||this.soundBuffers.length===0)return;const n=this.soundBuffers[Math.floor(Math.random()*this.soundBuffers.length)],s=this.audioContext.createBufferSource();s.buffer=n,s.playbackRate.value=1;const r=this.audioContext.createGain();r.gain.value=.8,s.connect(r),r.connect(this.audioContext.destination),s.start()}setSoundEnabled(e){const n=z();n.enableChatEffectSound=e,e&&!this.audioContext&&this.initAudio()}async start(e,n){const s=z();this.stop(),this.isFinished=!1,n!==void 0?this.speed=Number.isInteger(n)?n:Number.parseInt(n.toString(),10)||50:(console.warn("速度值未定义，将采用默认速度。"),this.speed=50),this.abortController=new AbortController;let r=0;this.textBuffers="",s.enableChatEffectSound&&!this.audioContext&&await this.initAudio();const o=()=>{if(!this.abortController?.signal.aborted)if(r<e.length){this.textBuffers+=e.charAt(r),this.element.value=this.textBuffers,this.element.textContent=this.textBuffers,this.playRandomSound(),r++,this.element.scrollTop=this.element.scrollHeight;const a=this.speed*.8,i=this.speed*.4,d=a+Math.random()*i;this.timer=setTimeout(o,d)}else this.finish()};o()}finish(){this.stop(),this.isFinished=!0,this.element.style.borderRight="none",this.onFinishCallback&&this.onFinishCallback()}stop(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.abortController&&(this.abortController.abort(),this.abortController=null),this.isFinished=!1}checkFinished(){return this.isFinished}onFinish(e){this.onFinishCallback=e}}function cr(t){const e=k(null),n=k(!1),s=()=>{t.value&&(e.value=new lr(t.value))},r=async(a,i)=>{e.value||s(),n.value=!0,await e.value?.start(a,i),n.value=!1},o=()=>{e.value?.stop(),n.value=!1};return _t(()=>{o()}),{startTyping:r,stopTyping:o,isTyping:n}}const ur={class:"chatbox-box"},dr={class:"chatbox-main"},fr={class:"chatbox-title-part"},hr={class:"chatbox-title"},pr={id:"character"},mr={class:"chatbox-subtitle"},gr={id:"character-sub"},vr={class:"chatbox-emotion"},br={id:"character-emotion"},yr={class:"chatbox-inputbox"},_r=["placeholder","onKeydown","readonly"],wr=["disabled"],Sr=L({__name:"GameDialog",emits:["player-continued","dialog-proceed"],setup(t,{expose:e,emit:n}){const s=k(""),r=k(null),o=G(),a=z(),{startTyping:i}=cr(r),d=se(()=>o.currentStatus==="thinking"),f=n,p=()=>{a.toggleSettings(!0),a.setSettingsTab("history")},m=se(()=>{switch(o.currentStatus){case"input":return"在这里输入消息...";case"thinking":return o.avatar.think_message;case"responding":return"";case"narrating":return"";default:return"在这里输入消息..."}}),v=se(()=>o.currentStatus==="input");N(()=>o.currentStatus,C=>{C==="thinking"?(o.avatar.emotion="AI思考",a.showCharacterTitle=o.avatar.character_name,a.showCharacterSubtitle=o.avatar.character_subtitle):C==="input"?(a.showCharacterTitle=o.avatar.user_name,a.showCharacterSubtitle=o.avatar.user_subtitle,a.showCharacterEmotion=""):C==="responding"?(a.showCharacterTitle=o.avatar.character_name,a.showCharacterSubtitle=o.avatar.character_subtitle):C==="narrating"&&(a.showCharacterTitle="",a.showCharacterSubtitle="",a.showCharacterEmotion="")}),N([()=>o.currentLine,()=>o.currentStatus],([C,A])=>{C&&C!==""&&(A==="responding"||A==="narrating")?(s.value="",i(C,a.typeWriterSpeed)):C===""&&A==="input"&&(s.value="")});function y(){o.currentStatus==="input"?u():o.currentStatus==="responding"?b(!0):o.currentStatus==="narrating"&&l()}function u(){s.value.trim()&&(yt.sendMessage(s.value),s.value="")}function b(C){const A=yt.continueMessage();return A||(C&&f("player-continued"),f("dialog-proceed")),A}function l(){qs.continueScript()}return e({continueDialog:b}),(C,A)=>(S(),E("div",ur,[h("div",dr,[h("div",fr,[h("div",hr,[h("div",pr,R(g(a).showCharacterTitle),1)]),h("div",mr,[h("div",gr,R(g(a).showCharacterSubtitle),1)]),h("div",vr,[h("div",br,R(g(a).showCharacterEmotion),1)]),_(g(I),{type:"nav",icon:"history",title:"",onClick:p})]),A[1]||(A[1]=h("div",{class:"chatbox-line"},null,-1)),h("div",yr,[j(h("textarea",{id:"inputMessage",ref_key:"textareaRef",ref:r,placeholder:m.value,"onUpdate:modelValue":A[0]||(A[0]=$=>s.value=$),onKeydown:St(Je(y,["exact","prevent"]),["enter"]),readonly:!v.value},null,40,_r),[[Ie,s.value]]),h("button",{id:"sendButton",disabled:d.value,onClick:y}," ▼ ",8,wr)])])]))}}),kr={class:"main-box"},Cr={id:"menu-panel"},Jo=L({__name:"MainChat",setup(t){const e=z(),n=G(),s=k(null),r=k(null),o=()=>{e.toggleSettings(!0),e.setSettingsTab("text")},a=()=>{e.autoMode=!e.autoMode},i=async()=>{try{await n.initializeGame("1"),s.value?s.value.setEmotion("正常",!0):console.log("这个组件不存在")}catch(u){console.log(u)}};re(i),N(()=>n.avatar.character_id,(y,u)=>{y&&y!==u&&(console.log(`Character ID changed to ${y}, re-initializing...`),i())});let d=null;const f=k(!1),p=()=>{f.value=!1,d&&(clearTimeout(d),d=null)},m=()=>{if(e.autoMode){if(f.value){console.log("父组件：音频结束了，但用户已手动继续，不做任何事。");return}n.currentStatus==="responding"&&(d&&clearTimeout(d),d=setTimeout(()=>{r.value?r.value.continueDialog(!1)&&m():console.error("无法找到 GameDialog 的实例。")},1e3))}},v=()=>{console.log("用户主动点击了"),d&&(clearTimeout(d),d=null,console.log("父组件：已取消自动继续的定时器。")),f.value?console.log("父组件：用户重复点击，但方法已执行过，不再调用。"):f.value=!0};return(y,u)=>(S(),E("div",kr,[_(g(Vs)),_(g(Ls),{ref_key:"gameAvatarRef",ref:s,onAudioEnded:m},null,512),_(g(Sr),{ref_key:"gameDialogRef",ref:r,onPlayerContinued:v,onDialogProceed:p},null,512),h("div",Cr,[j(_(g(I),{type:"nav",icon:"play",onClick:a,class:q([{active:g(e).autoMode}])},{default:w(()=>u[0]||(u[0]=[h("h3",null,"自动",-1)])),_:1,__:[0]},8,["class"]),[[Z,g(e).showSettings!==!0]]),j(_(g(I),{type:"nav",icon:"text",onClick:o},{default:w(()=>u[1]||(u[1]=[h("h3",null,"菜单",-1)])),_:1,__:[1]},512),[[Z,g(e).showSettings!==!0]])])]))}}),Er=L({__name:"MenuItem",props:{title:{type:String,default:"默认标题"},size:{type:String,default:"large",validator:t=>["small","large"].includes(t)}},setup(t){return(e,n)=>(S(),E("section",{class:q(["menu-item",t.size])},[h("div",null,[h("h4",null,R(t.title),1)]),le(e.$slots,"default",{},void 0)],2))}}),P=F(Er,[["__scopeId","data-v-3d007fbc"]]),xr={},Ar={class:"settings-page active"},Tr={class:"settings-columns"};function Rr(t,e){return S(),E("div",Ar,[h("div",Tr,[le(t.$slots,"default",{},void 0)])])}const ce=F(xr,[["render",Rr],["__scopeId","data-v-b11651d0"]]),$r=async t=>{try{return await Q.get("/v1/chat/history/list",{params:t})}catch(e){throw new Error(e.response?.data?.message||"获取存档列表失败")}},Or=async t=>{try{await Q.post("/v1/chat/history/create",t)}catch(e){throw new Error(e.response?.data?.detail||"存档创建失败")}},Br=async t=>{try{return await Q.get("/v1/chat/history/load",{params:t})}catch(e){throw new Error(e.response?.data?.detail||"存档加载失败")}},Ir=async t=>{try{await Q.post("/v1/chat/history/save",t)}catch(e){throw new Error(e.response?.data?.detail||"存档保存失败")}},Pr=async t=>{try{await Q.post("/v1/chat/history/delete",t)}catch(e){throw new Error(e.response?.data?.detail||"存档删除失败")}},Mr=et("ui",{state:()=>({user_id:"1"}),actions:{}}),Dr={class:"new-save-form"},Nr={class:"save-section"},Lr={class:"save-list-container"},Fr={key:0,class:"status-message"},Ur={key:1,class:"status-message error"},jr={key:2,class:"status-message"},Vr={key:3,class:"save-list"},Hr={class:"save-info"},zr={class:"save-title"},qr={class:"save-date"},Gr={class:"save-actions"},Jr=["onClick"],Wr=["onClick"],Kr=["onClick"],me="1",Qr=L({__name:"SettingsSave",setup(t){const e=G();Mr();const n=k([]),s=k(""),r=k(!1),o=k(null),a=v=>{const y=new Date(v);return`${y.getFullYear()}.${y.getMonth()+1}.${y.getDate()}`},i=async()=>{r.value=!0,o.value=null;try{const v=await $r({user_id:me,page:1,page_size:10});n.value=v.conversations}catch(v){console.error("获取存档列表失败:",v),o.value=v.message||"未知错误"}finally{r.value=!1}},d=async()=>{if(!s.value.trim()){alert("请输入存档名称！");return}try{await Or({user_id:me,title:s.value.trim()}),s.value="",await i()}catch(v){console.error("创建存档失败:",v),alert(`创建失败: ${v.message}`)}},f=async v=>{try{const y=await Br({user_id:me,conversation_id:v});alert(`存档 [${v}] 读取成功!`),e.initializeGame(me)}catch(y){console.error("读取存档失败:",y),alert(`读取失败: ${y.message}`)}},p=async v=>{try{await Ir({user_id:me,conversation_id:v}),alert(`成功覆盖存档 [${v}]!`),await i()}catch(y){console.error("保存游戏失败:",y),alert(`保存失败: ${y.message}`)}},m=async v=>{if(confirm("确定要删除这个存档吗？此操作不可撤销。"))try{await Pr({user_id:me,conversation_id:v}),await i()}catch(y){console.error("删除存档失败:",y),alert(`删除失败: ${y.message}`)}};return re(()=>{i()}),(v,y)=>(S(),Y(g(ce),null,{default:w(()=>[_(g(P),{title:"创建新存档"},{default:w(()=>[h("div",Dr,[_(g(er),{type:"text",modelValue:s.value,"onUpdate:modelValue":y[0]||(y[0]=u=>s.value=u),placeholder:"输入存档名称",onKeyup:St(d,["enter"])},null,8,["modelValue"]),h("button",{class:"glass-effect action-btn-create",onClick:d}," 创建 ")])]),_:1}),_(g(P),{title:"存档列表"},{default:w(()=>[h("div",Nr,[h("div",Lr,[r.value?(S(),E("div",Fr,"加载中...")):o.value?(S(),E("div",Ur," 加载失败: "+R(o.value),1)):n.value.length===0?(S(),E("div",jr," 暂无存档记录 ")):(S(),E("div",Vr,[(S(!0),E(V,null,oe(n.value,u=>(S(),E("div",{key:u.id,class:"save-card glass-effect"},[h("div",Hr,[h("span",zr,R(u.title||"未命名存档"),1),h("span",qr,R(a(u.updated_at)),1)]),h("div",Gr,[h("button",{onClick:b=>f(u.id),class:"glass-effect action-btn-load"}," 读取 ",8,Jr),h("button",{onClick:b=>p(u.id),class:"action-btn-save glass-effect"}," 保存 ",8,Wr),h("button",{onClick:b=>m(u.id),class:"action-btn-delete glass-effect"}," 删除 ",8,Kr)])]))),128))]))])])]),_:1})]),_:1}))}}),Xr=F(Qr,[["__scopeId","data-v-270f18d4"]]),Yr=L({__name:"SettingsText",setup(t){const e=k(),n=z(),s=a=>{e.value=a,n.typeWriterSpeed=a},r=a=>{console.log(a)},o=a=>{n.enableChatEffectSound=a};return(a,i)=>(S(),Y(g(ce),null,{default:w(()=>[_(g(P),{title:"⚡ 文字显示速度"},{default:w(()=>[_(g(Be),{onChange:s},{default:w(()=>i[0]||(i[0]=[B("慢/快",-1)])),_:1,__:[0]})]),_:1}),_(g(P),{title:"📝 显示文字样本"},{default:w(()=>[_(g(rr),{speed:e.value},{default:w(()=>i[1]||(i[1]=[B("Ling Chat: 测试文本显示速度",-1)])),_:1,__:[1]},8,["speed"])]),_:1}),_(g(P),{title:"✨ 页面切换动画",size:"small"},{default:w(()=>[_(g(_e),{onChange:r},{default:w(()=>i[2]||(i[2]=[B("启用动画效果",-1)])),_:1,__:[2]})]),_:1}),_(g(P),{title:"🌏 语音音效开关",size:"small"},{default:w(()=>[_(g(_e),{onChange:o},{default:w(()=>i[3]||(i[3]=[B("启用无vits时的对话音效",-1)])),_:1,__:[3]})]),_:1}),_(g(P),{title:"✨ WebSocket通信状态",size:"small"},{default:w(()=>i[4]||(i[4]=[h("p",null,"√ 连接正常",-1)])),_:1,__:[4]}),_(g(P),{title:"⚙ 当前使用的AI大模型",size:"small"},{default:w(()=>i[5]||(i[5]=[h("p",null,"DeepSeek V3",-1)])),_:1,__:[5]})]),_:1}))}}),Zr=F(Yr,[["__scopeId","data-v-cac01c53"]]),ea=async()=>{try{return await Q.get("/v1/chat/back-music/list")}catch(t){throw new Error(t.response?.data?.message||"获取音乐列表失败")}},ta=async t=>{try{await Q.post("/v1/chat/back-music/upload",t)}catch(e){throw new Error(e.response?.data?.detail||"存档上传失败")}},na=async t=>{try{await Q.delete("/v1/chat/back-music/delete",{params:{url:t}})}catch(e){throw new Error(e.response?.data?.detail||"存档上传失败")}},sa={class:"sound-test"},ra={class:"music-controls"},aa={class:"music-name"},oa={class:"music-list-container"},ia={key:0,class:"empty-list"},la=["onClick"],ca={class:"music-item-name"},ua={class:"music-upload"},da=L({__name:"SettingsSound",setup(t){const e=z(),n=k(null),s=k(null),r=k(null),o=k([]),a=k("未选择音乐"),i=k(!1),d=k(null),f=k(null),p=O=>{n.value&&(n.value.volume=O/100)},m=O=>{s.value&&(s.value.volume=O/100)},v=O=>{r.value&&(r.value.volume=O/100)};N(()=>e.backgroundVolume,O=>{r.value&&(r.value.volume=O/100)});const y=()=>{n.value&&(n.value.src="/audio_effects/角色音量测试.wav",n.value.play().catch(O=>console.error("测试角色音量播放失败:",O)))},u=()=>{s.value&&(s.value.src="/audio_effects/疑问.wav",s.value.play().catch(O=>console.error("测试气泡音量播放失败:",O)))},b=async()=>{o.value=await ea()},l=async O=>{if(!O){console.log("music对象不存在");return}if(confirm(`确定要删除《${O.name}》吗？`))try{await na(O.url),console.log(`正在删除音乐: ${O.url}`),alert(`《${O.name}》删除成功`),await b()}catch(T){console.error("删除音乐失败:",T),alert("删除音乐失败")}},C=async()=>{if(!d.value){alert("请先选择一个音乐文件");return}const O=d.value,T=[".mp3",".wav",".flac",".webm",".weba",".ogg",".m4a"],J=O.name.slice(O.name.lastIndexOf(".")).toLowerCase();if(!T.includes(J)){alert("不支持的音频格式。请上传: "+T.join(", "));return}const Te=new FormData;Te.append("file",O);try{await ta(Te),console.log(`正在上传文件: ${O.name}`),alert("音乐上传成功"),d.value=null,f.value&&(f.value.value=""),await b()}catch(Kt){console.error("上传音乐失败:",Kt),alert("音乐上传失败")}},A=se(()=>i.value?"⏸ 暂停":"▶ 播放"),$=O=>{if(!r.value)return;const T=`/api/v1/chat/back-music/music_file/${encodeURIComponent(O.url)}`;r.value.src=T,r.value.play().catch(J=>console.error("播放音乐失败:",J)),a.value=O.name,i.value=!0},X=()=>{r.value&&(i.value?r.value.pause():!r.value.src&&o.value.length>0?$(o.value[0]):r.value.play().catch(O=>console.error("恢复播放失败:",O)),i.value=!r.value.paused)},U=()=>{r.value&&(r.value.pause(),r.value.currentTime=0,i.value=!1)},te=()=>{f.value?.click()},ae=O=>{const T=O.target;T.files&&T.files.length>0?d.value=T.files[0]:d.value=null},pe=()=>{r.value&&(i.value=!r.value.paused)},Ae=()=>{i.value=!1};return re(()=>{b(),n.value&&(n.value.volume=e.characterVolume/100),s.value&&(s.value.volume=e.bubbleVolume/100),r.value&&(r.value.volume=e.backgroundVolume/100)}),(O,T)=>(S(),Y(g(ce),null,{default:w(()=>[_(g(P),{title:"👩 角色音量",size:"small"},{default:w(()=>[_(g(Be),{modelValue:g(e).characterVolume,"onUpdate:modelValue":T[0]||(T[0]=J=>g(e).characterVolume=J),onChange:p},{default:w(()=>T[3]||(T[3]=[B(" 弱/强 ",-1)])),_:1,__:[3]},8,["modelValue"])]),_:1}),_(g(P),{title:"💬 气泡音量",size:"small"},{default:w(()=>[_(g(Be),{onChange:m,modelValue:g(e).bubbleVolume,"onUpdate:modelValue":T[1]||(T[1]=J=>g(e).bubbleVolume=J)},{default:w(()=>T[4]||(T[4]=[B(" 弱/强 ",-1)])),_:1,__:[4]},8,["modelValue"])]),_:1}),_(g(P),{title:"🎶 背景音量",size:"small"},{default:w(()=>[_(g(Be),{onChange:v,modelValue:g(e).backgroundVolume,"onUpdate:modelValue":T[2]||(T[2]=J=>g(e).backgroundVolume=J)},{default:w(()=>T[5]||(T[5]=[B(" 弱/强 ",-1)])),_:1,__:[5]},8,["modelValue"])]),_:1}),_(g(P),{title:"🔊 声音测试",size:"small"},{default:w(()=>[h("div",sa,[_(g(I),{type:"big",onClick:y},{default:w(()=>T[6]||(T[6]=[B("测试角色音量",-1)])),_:1,__:[6]}),_(g(I),{type:"big",onClick:u},{default:w(()=>T[7]||(T[7]=[B("测试气泡音量",-1)])),_:1,__:[7]})])]),_:1}),_(g(P),{title:"⚙ 背景音乐设置"},{default:w(()=>[h("div",ra,[_(g(I),{type:"big",onClick:X,class:"left-button"},{default:w(()=>[B(R(A.value),1)]),_:1}),_(g(I),{type:"big",onClick:U,class:"left-button"},{default:w(()=>T[8]||(T[8]=[B("■ 停止",-1)])),_:1,__:[8]}),h("span",aa,"当前: "+R(a.value),1)]),h("div",oa,[o.value.length===0?(S(),E("div",ia," 暂无音乐，请上传 ")):ie("",!0),(S(!0),E(V,null,oe(o.value,J=>(S(),E("div",{key:J.url,class:"music-item",onClick:Te=>$(J)},[h("div",ca,R(J.name),1),_(g(I),{onClick:Te=>l(J),class:"action-btn-delete glass-effect"},{default:w(()=>T[9]||(T[9]=[B("删除",-1)])),_:2,__:[9]},1032,["onClick"])],8,la))),128))]),h("div",ua,[_(g(I),{type:"big",onClick:te},{default:w(()=>T[10]||(T[10]=[B("➕ 添加音乐",-1)])),_:1,__:[10]}),h("input",{ref_key:"fileInput",ref:f,type:"file",onChange:ae,accept:".mp3,.wav,.flac,.webm,.weba,.ogg,.m4a",style:{display:"none"}},null,544),_(g(I),{type:"big",onClick:C,disabled:!d.value},{default:w(()=>T[11]||(T[11]=[B("确认上传",-1)])),_:1,__:[11]},8,["disabled"])])]),_:1}),h("audio",{ref_key:"characterTestPlayer",ref:n},null,512),h("audio",{ref_key:"bubbleTestPlayer",ref:s},null,512),h("audio",{ref_key:"backgroundAudioPlayer",ref:r,loop:"",onTimeupdate:pe,onEnded:Ae},null,544)]),_:1}))}}),fa=F(da,[["__scopeId","data-v-74268141"]]),ha={class:"advanced-settings-box"},pa={class:"advanced-settings-grid"},ma={key:0,class:"loader"},ga={class:"category-title"},va=["onClick"],ba={class:"advanced-content"},ya={key:0,class:"adv-content-page active"},_a={class:"advanced-settings-container"},wa={class:"adv-title"},Sa={class:"adv-description"},ka={class:"checkbox-label"},Ca=["id","checked","onChange"],Ea={class:"description"},xa=["for"],Aa={class:"description"},Ta=["id","onUpdate:modelValue"],Ra=["for"],$a={class:"description"},Oa=["id","onUpdate:modelValue"],Ba={class:"save-actions"},Ia={key:1,class:"adv-content-page active"},Pa=L({__name:"SettingsAdvance",setup(t){const e=k(!1),n=k({}),s=rt({category:null,subcategory:null}),r=rt({message:"",color:"var(--success-color)"}),o=k(null),a=k(null),i=se(()=>s.category&&s.subcategory?n.value[s.category]?.subcategories[s.subcategory]:null),d=(u,b)=>s.category===u&&s.subcategory===b,f=(u,b)=>{s.category=u,s.subcategory=b},p=(u,b)=>{u.value=b?"true":"false"},m=async()=>{if(!i.value)return;const u={};i.value.settings.forEach(b=>{u[b.key]=b.value}),e.value=!0,r.message="";try{const b=await fetch("/api/settings/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}),l=await b.json();if(!b.ok)throw new Error(l.detail||"保存失败");r.message=l.message,r.color="var(--success-color)",await v(!1)}catch(b){r.message=`错误: ${b.message}`,r.color="red"}finally{e.value=!1,setTimeout(()=>{r.message=""},5e3)}},v=async(u=!0)=>{e.value=!0;try{const b=await fetch("/api/settings/config");if(!b.ok)throw new Error("无法加载配置");if(n.value=await b.json(),u&&Object.keys(n.value).length>0){const l=Object.keys(n.value)[0],C=Object.keys(n.value[l].subcategories)[0];l&&C&&f(l,C)}}catch(b){console.error(b),r.message=`加载配置失败: ${b.message}`,r.color="red"}finally{e.value=!1}},y=()=>{if(!o.value||!a.value)return;const u=o.value.querySelector(".adv-nav-link.active");if(u){const b=u.offsetTop,l=u.offsetHeight;a.value.style.top=`${b}px`,a.value.style.height=`${l}px`}};return N(s,async()=>{await Ge(),y()},{deep:!0}),re(async()=>{await v(),await Ge(),y()}),(u,b)=>(S(),Y(g(ce),null,{default:w(()=>[h("div",ha,[h("div",pa,[e.value?(S(),E("div",ma,b[0]||(b[0]=[h("div",{class:"spinner"},null,-1)]))):ie("",!0),h("nav",{ref_key:"navContainerRef",ref:o,class:"advanced-nav"},[h("div",{ref_key:"indicatorRef",ref:a,class:"adv-nav-indicator"},null,512),(S(!0),E(V,null,oe(n.value,(l,C)=>(S(),E("div",{key:C,class:"adv-nav-category"},[h("span",ga,R(C),1),(S(!0),E(V,null,oe(l.subcategories,(A,$)=>(S(),E("a",{key:$,href:"#",class:q(["adv-nav-link",{active:d(C,$.toString())}]),onClick:Je(X=>f(C,$.toString()),["prevent"])},R($),11,va))),128))]))),128))],512),h("main",ba,[i.value?(S(),E("div",ya,[h("div",_a,[h("header",null,[h("h2",wa,R(s.subcategory),1),h("p",Sa,R(i.value.description||`修改 ${s.subcategory} 的相关配置`),1)]),h("form",{class:"settings-form",onSubmit:Je(m,["prevent"])},[(S(!0),E(V,null,oe(i.value.settings,l=>(S(),E("div",{key:l.key,class:"form-group"},[l.type==="bool"?(S(),E(V,{key:0},[h("label",ka,[h("input",{type:"checkbox",id:l.key,checked:l.value.toLowerCase()==="true",onChange:C=>p(l,C.target.checked)},null,40,Ca),B(" "+R(l.key),1)]),h("p",Ea,R(l.description||""),1)],64)):l.type==="textarea"?(S(),E(V,{key:1},[h("label",{for:l.key},R(l.key),9,xa),h("p",Aa,R(l.description||"支持多行输入"),1),j(h("textarea",{id:l.key,"onUpdate:modelValue":C=>l.value=C,class:"form-control",rows:"8"},null,8,Ta),[[Ie,l.value]])],64)):(S(),E(V,{key:2},[h("label",{for:l.key},R(l.key),9,Ra),h("p",$a,R(l.description||""),1),j(h("input",{type:"text",id:l.key,"onUpdate:modelValue":C=>l.value=C,class:"form-control"},null,8,Oa),[[Ie,l.value]])],64))]))),128))],32),h("div",Ba,[h("button",{onClick:m},"保存"),h("p",{style:Se({color:r.color})},R(r.message),5)])])])):!e.value&&!Object.keys(n.value).length?(S(),E("div",Ia,b[1]||(b[1]=[h("div",{class:"advanced-settings-container"},[h("header",null,[h("h2",{class:"adv-title"},"加载失败"),h("p",{class:"adv-description"},"无法加载配置或配置为空。")])],-1)]))):ie("",!0)])])])]),_:1}))}}),Ma=F(Pa,[["__scopeId","data-v-04147be7"]]),Da={class:"history-container"},Na={key:0,class:"status-message"},La={class:"message-item"},Fa={key:0,class:"player-message"},Ua={class:"name"},ja={class:"content"},Va=["title"],Ha={class:"name"},za={class:"content"},qa={key:0,class:"final-spacer"},Ga=L({__name:"SettingsHistory",setup(t){const e=G(),n=se(()=>e.dialogHistory),s=k(null);return N(n,()=>{s.value&&(s.value.scrollTop=s.value.scrollHeight)},{flush:"post",deep:!0}),(r,o)=>(S(),Y(g(ce),null,{default:w(()=>[_(g(P),{title:"◈ 历史对话"},{default:w(()=>[h("div",Da,[n.value.length===0?(S(),E("div",Na," 暂无历史记录，去和ta聊聊天叭(*^▽^*) ")):(S(),E("div",{key:1,class:"chat-history-container",ref_key:"chatContainer",ref:s},[(S(!0),E(V,null,oe(n.value,(a,i)=>(S(),E(V,{key:a.timestamp||i},[h("div",La,[a.type==="message"?(S(),E("div",Fa,[h("span",Ua,R(g(e).avatar.user_name)+": ",1),h("span",ja,R(a.content),1)])):a.type==="reply"?(S(),E("div",{key:1,class:"ai-reply",title:`情绪: ${a.originalTag}`},[h("span",Ha,R(g(e).avatar.character_name)+": ",1),h("span",za,[B(R(a.content)+" ",1),a.motionText?(S(),E(V,{key:0},[B("("+R(a.motionText)+")",1)],64)):ie("",!0)])],8,Va)):ie("",!0)]),a.isFinal?(S(),E("div",qa)):ie("",!0)],64))),128))],512))])]),_:1})]),_:1}))}}),Ja=F(Ga,[["__scopeId","data-v-eae9bde5"]]),Wa=L({__name:"SettingsSchedule",setup(t){return(e,n)=>(S(),Y(g(ce),null,{default:w(()=>[_(g(P),{title:"主动提醒",size:"small"},{default:w(()=>[_(g(_e),null,{default:w(()=>n[0]||(n[0]=[B("是否开启日程主动提醒功能",-1)])),_:1,__:[0]})]),_:1}),_(g(P),{title:"随机聊天",size:"small"},{default:w(()=>[_(g(_e),null,{default:w(()=>n[1]||(n[1]=[B("是否开启随机间隔主动聊天功能",-1)])),_:1,__:[1]})]),_:1}),_(g(P),{title:"窥屏权限",size:"small"},{default:w(()=>[_(g(_e),null,{default:w(()=>n[2]||(n[2]=[B("是否开启主动窥屏聊天功能",-1)])),_:1,__:[2]})]),_:1}),_(g(P),{title:"日程列表",size:"large"},{default:w(()=>n[3]||(n[3]=[B(" 日程组件 ",-1)])),_:1,__:[3]})]),_:1}))}}),Ka={class:"character-card"},Qa={class:"character-avatar-container"},Xa=["src","alt"],Ya={class:"character-content"},Za={class:"character-title"},eo={class:"character-description"},to={class:"character-actions"},no=L({__name:"CharacterCard",props:{avatar:{},name:{},info:{}},setup(t){return(e,n)=>(S(),E("div",Ka,[h("div",Qa,[h("img",{src:e.avatar,alt:e.name,class:"character-avatar"},null,8,Xa)]),h("div",Ya,[h("h5",Za,R(e.name),1),h("p",eo,R(e.info),1),h("div",to,[le(e.$slots,"actions",{},void 0)])])]))}}),so=F(no,[["__scopeId","data-v-1f2f7db6"]]),ro={};function ao(t,e){return S(),E("div",null,[le(t.$slots,"default",{},void 0)])}const oo=F(ro,[["render",ao],["__scopeId","data-v-0e08aff2"]]),io=async()=>{try{return await Q.get("/v1/chat/character/get_all_characters")}catch(t){throw new Error(t.response?.data?.message||"获取角色列表失败")}},lo=async t=>{try{return(await Q.post("/v1/chat/character/select_character",t)).data}catch(e){throw new Error(e.response?.data?.detail||"角色选择失败")}},co={class:"character-list character-grid"},uo=L({__name:"SettingsCharacter",setup(t){const e=k([]),n=k(1),s=G(),r=async()=>{try{return(await io()).map(v=>({id:parseInt(v.character_id),title:v.title,info:v.info||"暂无角色描述",avatar:v.avatar_path?`/api/v1/chat/character/character_file/${encodeURIComponent(v.avatar_path)}`:"../pictures/characters/default.png"}))}catch(m){return console.error("获取角色列表失败:",m),[]}},o=async()=>{try{const m=await r();e.value=m}catch(m){console.error("加载角色失败:",m)}},a=async()=>{await s.initializeGame("1")},i=async m=>{try{await lo({user_id:n.value.toString(),character_id:m.toString()}),a()}catch(v){console.error("切换角色失败:",v)}},d=async()=>{try{const m=await fetch("/api/v1/chat/character/refresh_characters",{method:"POST",headers:{"Content-Type":"application/json"}});if(!m.ok)throw new Error(`HTTP error! status: ${m.status}`);await m.json(),alert("刷新成功"),await o()}catch(m){alert("刷新失败"),console.error("刷新失败:",m)}},f=async()=>{try{const m=await fetch("/api/v1/chat/character/open_web");if(!m.ok)throw new Error(`HTTP error! status: ${m.status}`);await m.json()}catch(m){alert("启动失败，请手动去lingchat的discussion网页"),console.error("打开创意工坊失败:",m)}};function p(m){return s.avatar.character_id===m}return re(()=>{o()}),(m,v)=>(S(),Y(g(ce),null,{default:w(()=>[_(g(P),{title:"角色列表"},{default:w(()=>[_(oo,null,{default:w(()=>[h("div",co,[(S(!0),E(V,null,oe(e.value,y=>(S(),Y(so,{key:y.id,avatar:y.avatar,name:y.title,info:y.info},{actions:w(()=>[_(g(I),{type:"select",class:q(["character-select-btn",{selected:p(y.id)}]),onClick:u=>i(y.id)},{default:w(()=>[B(R(p(y.id)?"√ 选中":"选择"),1)]),_:2},1032,["class","onClick"])]),_:2},1032,["avatar","name","info"]))),128))])]),_:1})]),_:1}),_(g(P),{title:"刷新人物列表",size:"small"},{default:w(()=>[_(g(I),{type:"big",onClick:d},{default:w(()=>v[0]||(v[0]=[B("点我刷新~",-1)])),_:1,__:[0]})]),_:1}),_(g(P),{title:"创意工坊",size:"small"},{default:w(()=>[_(g(I),{type:"big",onClick:f},{default:w(()=>v[1]||(v[1]=[B("进入创意工坊",-1)])),_:1,__:[1]})]),_:1})]),_:1}))}}),fo=F(uo,[["__scopeId","data-v-8b096622"]]),ho=async()=>{try{return await Q.get("/v1/chat/background/list",{})}catch(t){throw console.error("获取游戏信息错误:",t.message),t}},po={class:"background-container"},mo={class:"background-list character-grid"},go={class:"background-image-container"},vo=["src","alt"],bo=["data-title"],yo={class:"effect-list"},_o=L({__name:"SettingsBackground",setup(t){const e=k([]),n=k(""),s=k(null),r=z();re(async()=>{try{await a();const v=localStorage.getItem("selectedBackground");if(v)d(v);else if(e.value.length>0){const y=Math.floor(Math.random()*e.value.length);d(e.value[y].url),console.log("已选随机背景")}}catch(v){console.error("加载背景图片失败",v)}});async function o(){try{return(await ho()).map(y=>({title:y.title?y.title:"草泥马",url:y.url?`/api/v1/chat/background/background_file/${encodeURIComponent(y.url)}`:"../pictures/background/default.png",time:y.time}))}catch(v){return console.error("获取背景列表失败:",v),[]}}async function a(){e.value=await o()}function i(v){return n.value===v}function d(v){n.value=v,r.currentBackground=v,localStorage.setItem("selectedBackground",v)}function f(){s.value&&s.value.click()}async function p(v){const y=v.target,u=y.files?.[0];if(!u)return;const b=u.name,l=b.slice(b.lastIndexOf(".")).toLowerCase(),C=[".jpg",".png",".webp",".bmp",".svg",".tif",".gif"];if(!C.includes(l)){alert("请上传支持的图片格式: "+C.join(", "));return}const A=new FormData;A.append("file",u),A.append("name",b);try{if(!(await fetch("/api/v1/chat/background/upload",{method:"POST",body:A})).ok)throw new Error("上传失败");await a(),y&&(y.value="")}catch($){console.error("上传失败",$),alert("上传失败，请重试")}}function m(v){r.currentBackgroundEffect=v}return(v,y)=>(S(),Y(g(ce),null,{default:w(()=>[_(g(P),{title:"背景选择"},{default:w(()=>[h("div",po,[h("div",mo,[(S(!0),E(V,null,oe(e.value,(u,b)=>(S(),E("div",{key:b,class:q(["background-card",{selected:i(u.url)}])},[h("div",go,[h("img",{src:u.url,alt:u.title,class:"background-image"},null,8,vo)]),h("div",{class:"background-title","data-title":u.title},[_(g(I),{class:q(["background-select-btn",{selected:i(u.url)}]),onClick:l=>d(u.url)},{default:w(()=>[B(R(i(u.url)?"已选中":"选择"),1)]),_:2},1032,["class","onClick"])],8,bo)],2))),128))]),_(g(I),{type:"big",onClick:f},{default:w(()=>y[2]||(y[2]=[B("上传自定义背景",-1)])),_:1,__:[2]}),h("input",{type:"file",ref_key:"uploadInput",ref:s,onChange:p,accept:".jpg,.png,.webp,.bmp,.svg,.tif,.gif",style:{display:"none"}},null,544)])]),_:1}),_(g(P),{title:"粒子选择",size:"large"},{default:w(()=>[h("div",yo,[_(g(I),{type:"big",onClick:y[0]||(y[0]=u=>m("StarField"))},{default:w(()=>y[3]||(y[3]=[B("星空",-1)])),_:1,__:[3]}),_(g(I),{type:"big",onClick:y[1]||(y[1]=u=>m("Rain"))},{default:w(()=>y[4]||(y[4]=[B("雨水",-1)])),_:1,__:[4]})])]),_:1})]),_:1}))}}),wo=F(_o,[["__scopeId","data-v-43f329d9"]]),So={class:"nav-container"},ko=L({__name:"SettingsNav",setup(t){const e=z(),n=k(null),s=k(null),r=k(null),o=k(null),a=k(null),i=k(null),d=k(null),f=k(null),p=k(null),m=(b,l)=>{e.setSettingsTab(b);const C={characterBtn:s,textBtn:r,backgroundBtn:o,soundBtn:a,historyBtn:i,saveBtn:d,advanceBtn:f,scheduleBtn:p}[l];C?.value?.$el&&v(C.value.$el)},v=b=>{!n.value||!b||(n.value.style.left=`${b.offsetLeft}px`,n.value.style.width=`${b.offsetWidth}px`)},y=()=>{const b=e.currentSettingsTab;let l=null;switch(b){case"character":l=s.value;break;case"text":l=r.value;break;case"background":l=o.value;break;case"sound":l=a.value;break;case"history":l=i.value;break;case"save":l=d.value;break;case"advance":l=f.value;break;case"schedule":l=p.value;break}l?.$el&&v(l.$el)};re(()=>{y()}),N(()=>e.currentSettingsTab,()=>{y()});const u=()=>{e.toggleSettings(!1)};return(b,l)=>(S(),E("div",So,[l[16]||(l[16]=h("img",{src:tn,alt:"Logo",class:"settings-logo"},null,-1)),h("nav",null,[h("div",{ref_key:"indicator",ref:n,class:"nav-indicator"},null,512),_(g(I),{ref_key:"characterBtn",ref:s,type:"nav",icon:"character",onClick:l[0]||(l[0]=()=>m("character","characterBtn")),class:q({active:g(e).currentSettingsTab==="character"})},{default:w(()=>l[8]||(l[8]=[h("p",{class:"button-text"},"角色",-1)])),_:1,__:[8]},8,["class"]),_(g(I),{ref_key:"textBtn",ref:r,type:"nav",icon:"text",onClick:l[1]||(l[1]=()=>m("text","textBtn")),class:q({active:g(e).currentSettingsTab==="text"})},{default:w(()=>l[9]||(l[9]=[h("p",{class:"button-text"},"文本",-1)])),_:1,__:[9]},8,["class"]),_(g(I),{ref_key:"backgroundBtn",ref:o,type:"nav",icon:"background",onClick:l[2]||(l[2]=()=>m("background","backgroundBtn")),class:q({active:g(e).currentSettingsTab==="background"})},{default:w(()=>l[10]||(l[10]=[h("p",{class:"button-text"},"背景",-1)])),_:1,__:[10]},8,["class"]),_(g(I),{ref_key:"soundBtn",ref:a,type:"nav",icon:"sound",onClick:l[3]||(l[3]=()=>m("sound","soundBtn")),class:q({active:g(e).currentSettingsTab==="sound"})},{default:w(()=>l[11]||(l[11]=[h("p",{class:"button-text"},"声音",-1)])),_:1,__:[11]},8,["class"]),_(g(I),{ref_key:"historyBtn",ref:i,type:"nav",icon:"history",onClick:l[4]||(l[4]=()=>m("history","historyBtn")),class:q({active:g(e).currentSettingsTab==="history"})},{default:w(()=>l[12]||(l[12]=[h("p",{class:"button-text"},"对话历史",-1)])),_:1,__:[12]},8,["class"]),_(g(I),{ref_key:"saveBtn",ref:d,type:"nav",icon:"save",onClick:l[5]||(l[5]=()=>m("save","saveBtn")),class:q({active:g(e).currentSettingsTab==="save"})},{default:w(()=>l[13]||(l[13]=[h("p",{class:"button-text"},"存档",-1)])),_:1,__:[13]},8,["class"]),_(g(I),{ref_key:"scheduleBtn",ref:p,type:"nav",icon:"schedule",onClick:l[6]||(l[6]=()=>m("schedule","scheduleBtn")),class:q({active:g(e).currentSettingsTab==="schedule"})},{default:w(()=>l[14]||(l[14]=[h("p",{class:"button-text"},"日程",-1)])),_:1,__:[14]},8,["class"]),_(g(I),{ref_key:"advanceBtn",ref:f,type:"nav",icon:"advance",onClick:l[7]||(l[7]=()=>m("advance","advanceBtn")),class:q({active:g(e).currentSettingsTab==="advance"})},{default:w(()=>l[15]||(l[15]=[h("p",{class:"button-text"},"高级设置",-1)])),_:1,__:[15]},8,["class"])]),_(Wt,{icon:"close",class:"close-button",size:40,onClick:u})]))}}),Co={class:"settings-panel"},Eo={class:"header"},xo={class:"container"},Wo=L({__name:"SettingsPanel",setup(t){const e=z();return(n,s)=>(S(),E(V,null,[h("div",{class:"blur-overlay",style:Se({opacity:g(e).showSettings?1:0})},null,4),j(h("div",Co,[h("div",Eo,[_(ko)]),h("div",xo,[j(_(g(Xr),null,null,512),[[Z,g(e).currentSettingsTab==="save"]]),j(_(g(Zr),null,null,512),[[Z,g(e).currentSettingsTab==="text"]]),j(_(g(fa),null,null,512),[[Z,g(e).currentSettingsTab==="sound"]]),j(_(g(Ma),null,null,512),[[Z,g(e).currentSettingsTab==="advance"]]),j(_(g(Ja),null,null,512),[[Z,g(e).currentSettingsTab==="history"]]),j(_(g(Wa),null,null,512),[[Z,g(e).currentSettingsTab==="schedule"]]),j(_(g(fo),null,null,512),[[Z,g(e).currentSettingsTab==="character"]]),j(_(g(wo),null,null,512),[[Z,g(e).currentSettingsTab==="background"]])])],512),[[Z,g(e).showSettings]])],64))}});export{Jo as _,Wo as a};
