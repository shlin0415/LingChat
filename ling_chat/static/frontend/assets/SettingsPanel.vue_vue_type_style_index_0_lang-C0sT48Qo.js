import{p as Y,d as V,q as j,r as m,o as N,s as M,a as ye,c as w,b as t,h as _,v as oe,x as ue,F as O,m as W,n as ee,y as G,i as F,e as K,k as a,j as z,z as J,A as we,B as de,C as R,D as B,t as S,E as ne,G as ke,f,H as ve,I as le,J as $e,K as Se,L as H,w as h,M as U,N as Ce,O as ie}from"./index-DEaQ7Adm.js";import{a as D,S as xe,_ as Ae}from"./StarField-DBNwQDXx.js";const ce="/api/v1",E={AVATAR:{BASE:`${ce}/chat/character/get_avatar`},VOICE:{BASE:`${ce}/chat/sound/get_voice`}},se={åŽŒæ¶:{animation:"none",bubbleImage:"../pictures/animation/ç”Ÿæ°”.webp",bubbleClass:"angry",audio:"../audio_effects/åŽŒæ¶.wav",avatar:`${E.AVATAR.BASE}/åŽŒæ¶.png`},é«˜å…´:{animation:"happy-bounce",bubbleImage:"../pictures/animation/é«˜å…´.webp",bubbleClass:"happy",audio:"../audio_effects/å–œæ‚¦.wav",avatar:`${E.AVATAR.BASE}/é«˜å…´.png`},æ‹…å¿ƒ:{animation:"none",bubbleImage:"../pictures/animation/æµæ³ª.webp",bubbleClass:"none",audio:"../audio_effects/ä¼¤å¿ƒ.wav",avatar:`${E.AVATAR.BASE}/æ‹…å¿ƒ.png`},ç”Ÿæ°”:{animation:"angry-jump",bubbleImage:"../pictures/animation/ç”Ÿæ°”2.webp",bubbleClass:"angry",audio:"../audio_effects/ç”Ÿæ°”.wav",avatar:`${E.AVATAR.BASE}/ç”Ÿæ°”.png`},ç´§å¼ :{animation:"none",bubbleImage:"../pictures/animation/ç´§å¼ .webp",bubbleClass:"none",audio:"../audio_effects/å°´å°¬.wav",avatar:`${E.AVATAR.BASE}/ç´§å¼ .png`},å®³æ€•:{animation:"none",bubbleImage:"../pictures/animation/æƒŠè®¶.webp",bubbleClass:"none",audio:"../audio_effects/éœ‡æƒŠ.wav",avatar:`${E.AVATAR.BASE}/å®³æ€•.png`},å®³ç¾ž:{animation:"none",bubbleImage:"../pictures/animation/å®³ç¾ž.webp",bubbleClass:"shy",audio:"../audio_effects/å®³ç¾ž.wav",avatar:`${E.AVATAR.BASE}/å®³ç¾ž.png`},æ…Œå¼ :{animation:"none",bubbleImage:"../pictures/animation/æ…Œä¹±.webp",bubbleClass:"none",audio:"../audio_effects/éœ‡æƒŠ.wav",avatar:`${E.AVATAR.BASE}/æ…Œå¼ .png`},è®¤çœŸ:{animation:"serious-think",bubbleImage:"none",bubbleClass:"none",audio:"none",avatar:`${E.AVATAR.BASE}/è®¤çœŸ.png`},æ— å¥ˆ:{animation:"none",bubbleImage:"../pictures/animation/å¹æ°”.webp",bubbleClass:"none",audio:"../audio_effects/å¹æ°”.wav",avatar:`${E.AVATAR.BASE}/æ— å¥ˆ.png`},å…´å¥‹:{animation:"happy-bounce",bubbleImage:"../pictures/animation/èŠå¤©.webp",bubbleClass:"none",audio:"../audio_effects/èŠå¤©.wav",avatar:`${E.AVATAR.BASE}/å…´å¥‹.png`},ç–‘æƒ‘:{animation:"none",bubbleImage:"../pictures/animation/ç–‘é—®.webp",bubbleClass:"none",audio:"../audio_effects/ç–‘é—®.wav",avatar:`${E.AVATAR.BASE}/ç–‘æƒ‘.png`},å“­æ³£:{animation:"none",bubbleImage:"../pictures/animation/æµæ³ª.webp",bubbleClass:"none",audio:"../audio_effects/ä¼¤å¿ƒ.wav",avatar:`${E.AVATAR.BASE}/ä¼¤å¿ƒ.png`},å¿ƒåŠ¨:{animation:"heart-beat",bubbleImage:"../pictures/animation/å¿ƒåŠ¨.webp",bubbleClass:"none",audio:"../audio_effects/å–œçˆ±.wav",avatar:`${E.AVATAR.BASE}/å¿ƒåŠ¨.png`},è°ƒçš®:{animation:"naughty-bounce",bubbleImage:"../pictures/animation/é«˜å…´.webp",bubbleClass:"none",audio:"../audio_effects/æ„‰å¿«.wav",avatar:`${E.AVATAR.BASE}/è°ƒçš®.png`},éš¾ä¸ºæƒ…:{animation:"embarrassed-emo",bubbleImage:"../pictures/animation/éš¾ä¸ºæƒ….webp",bubbleClass:"none",audio:"../audio_effects/å¯Ÿè§‰.wav",avatar:`${E.AVATAR.BASE}/ç¾žè€».png`},è‡ªä¿¡:{animation:"none",bubbleImage:"../pictures/animation/é«˜å…´.webp",bubbleClass:"none",audio:"../audio_effects/æ„‰å¿«.wav",avatar:`${E.AVATAR.BASE}/è‡ªä¿¡.png`},æƒŠè®¶:{animation:"none",bubbleImage:"../pictures/animation/æƒŠè®¶.webp",bubbleClass:"none",audio:"../audio_effects/å¯Ÿè§‰.wav",avatar:`${E.AVATAR.BASE}/æƒŠè®¶.png`},æ­£å¸¸:{animation:"none",bubbleImage:"none",bubbleClass:"none",audio:"none",avatar:`${E.AVATAR.BASE}/æ­£å¸¸.png`},AIæ€è€ƒ:{animation:"none",bubbleImage:"../pictures/animation/AIæ€è€ƒ.webp",bubbleClass:"none",audio:"../audio_effects/æ— è¯­.wav",avatar:"none"}};class Be{currentEmotion;animationEndHandler;DOM;constructor(e){this.DOM=e;const n=Y();this.currentEmotion=n.avatar.emotion||"æ­£å¸¸",this.animationEndHandler=this._handleAnimationEnd.bind(this),this.DOM.avatar.container.addEventListener("animationend",this.animationEndHandler)}setEmotion(e,n=!1){if(!se[e]){console.log(`æœªçŸ¥è¡¨æƒ…: ${e}`);return}if(this.currentEmotion===e&&!n)return;const s=se[e];if(this._clearCurrentEffects(),s.avatar&&s.avatar!=="none")try{this.DOM.avatar.img.classList.add("loading");const o=new Image;o.onload=()=>{this.DOM.avatar.img.style.backgroundImage=`url(${o.src})`,this.DOM.avatar.img.classList.remove("loading")},o.onerror=()=>{console.log(`åŠ è½½å¤´åƒå¤±è´¥: ${s.avatar}`),this.DOM.avatar.img.classList.remove("loading"),this.DOM.avatar.img.style.backgroundImage="url(/api/v1/chat/character/get_avatar/æ­£å¸¸.png)"};const p=Date.now();o.src=`${s.avatar}?t=${p}`}catch(o){console.error("è®¾ç½®è¡¨æƒ…å¤´åƒæ—¶å‡ºé”™:",o),this.DOM.avatar.img.classList.remove("loading")}s.animation!=="none"&&(this.DOM.avatar.container.classList.remove(this.currentEmotion),this.DOM.avatar.container.classList.add(s.animation)),s.bubbleImage!=="none"&&this._showBubbleEffect(s),s.audio!=="none"&&(this.DOM.bubbleAudio.src=s.audio,this.DOM.bubbleAudio.load(),this.DOM.bubbleAudio.play()),this.currentEmotion=e}_clearCurrentEffects(){Object.values(se).forEach(({animation:e})=>{e!=="none"&&this.DOM.avatar.container.classList.remove(e)})}_showBubbleEffect(e){const n=Date.now();e.bubbleImage!=="none"&&(this.DOM.avatar.bubble.classList.remove("show"),this.DOM.avatar.bubble.offsetWidth,this.DOM.avatar.bubble.style.backgroundImage=`url(${e.bubbleImage}?t=${n}#t=0.1)`,this.DOM.avatar.bubble.classList.add(e.bubbleClass),this.DOM.avatar.bubble.classList.add("show"),setTimeout(()=>{this.DOM.avatar.bubble.classList.remove("show"),this.DOM.avatar.bubble.classList.remove(e.bubbleClass)},2e3))}_handleAnimationEnd(){this._clearCurrentEffects(),this.DOM.avatar.container.classList.add("normal")}destroy(){this.DOM.avatar.container.removeEventListener("animationend",this.animationEndHandler)}}const Ie=V({__name:"GameAvatar",emits:["audio-ended"],setup(d,{expose:e,emit:n}){const s=Y(),o=j(),p=m(null),i=m(null),r=m(null),g=m(null),k=m(null);let x=null;const b=(c,y=!1)=>{x?.setEmotion(c,y)},u=n,v=()=>{u("audio-ended")};return N(()=>{x=new Be({avatar:{container:p.value,img:i.value,bubble:r.value},bubbleAudio:k.value}),x.setEmotion(s.avatar.emotion),M(()=>s.avatar.emotion,c=>{x?.setEmotion(c)}),M(()=>o.currentAvatarAudio,c=>{g.value&&c&&c!=="None"&&(g.value.src=`${E.VOICE.BASE}/${c}`,g.value.load(),g.value.play())}),M(()=>s.avatar.offset,c=>{i.value&&i.value.style&&(i.value.style.top=c.toString()+"px")}),M(()=>s.avatar.scale,c=>{i.value&&i.value.style&&(i.value.style.transform=`scale(${c})`)}),M(()=>s.avatar.bubble_left,c=>{r.value&&r.value.style&&(r.value.style.left=c.toString()+"%")}),M(()=>s.avatar.bubble_top,c=>{r.value&&r.value.style&&(r.value.style.top=c.toString()+"%")}),M(()=>o.characterVolume,c=>{g.value&&(g.value.volume=c/100)}),M(()=>o.bubbleVolume,c=>{k.value&&(k.value.volume=c/100)})}),ye(()=>{x?.destroy()}),e({setEmotion:b}),(c,y)=>(_(),w("div",{ref_key:"avatarContainer",ref:p,class:"avatar-container character-animation normal"},[t("div",{ref_key:"avatarImg",ref:i,class:"avatar-img",id:"qinling"},null,512),t("div",{ref_key:"avatarBubble",ref:r,class:"bubble"},null,512),t("audio",{ref_key:"avatarAudio",ref:g,onEnded:v},null,544),t("audio",{ref_key:"bubbleAudio",ref:k},null,512)],512))}}),Te={__name:"Rain",props:{enabled:{type:Boolean,default:!0},intensity:{type:Number,default:1,validator:d=>d>=0&&d<=2}},setup(d){const e=d,n=m(50),s=m(20),o=m([]),p=m(null),i=m(null),r=m(0),g=m(null);M(()=>e.intensity,u=>{n.value=Math.max(10,100-u*45)},{immediate:!0});const k=()=>{e.enabled&&(clearInterval(p.value),p.value=setInterval(()=>{const u={top:-100,left:`${~~(Math.random()*100)}%`,speed:10+Math.random()*10*e.intensity,size:30+Math.random()*40*e.intensity,opacity:.2+Math.random()*.5};o.value.push(u)},n.value))},x=()=>{e.enabled&&(clearInterval(i.value),i.value=setInterval(()=>{const u=o.value.filter(v=>v.top<r.value);u.forEach(v=>{v.top+=v.speed}),o.value=u},s.value))},b=()=>{g.value&&g.value.parentElement?r.value=g.value.parentElement.clientHeight:r.value=window.innerHeight};return N(()=>{oe(()=>{b(),e.enabled&&(k(),x())}),window.addEventListener("resize",b)}),ue(()=>{clearInterval(p.value),clearInterval(i.value),window.removeEventListener("resize",b)}),M(()=>e.enabled,u=>{u?(b(),k(),x()):(clearInterval(p.value),clearInterval(i.value),o.value=[])}),(u,v)=>(_(),w("div",{class:"rain-container",ref_key:"containerRef",ref:g},[(_(!0),w(O,null,W(o.value,(c,y)=>(_(),w("span",{class:"rain-item",key:y,style:ee({top:`${c.top}px`,left:c.left,height:`${c.size}px`,opacity:c.opacity})},null,4))),128))],512))}},Ee=D(Te,[["__scopeId","data-v-76d838e4"]]),Me={__name:"GameBackground",setup(d){const e=j(),n=m(null),s=m(!0),o=m(200),p=m(.4),i=m(["rgb(173, 216, 230)","rgb(176, 224, 230)","rgb(241, 141, 252)","rgb(176, 230, 224)","rgb(173, 230, 216)"]),r=m(!1),g=m(!0),k=m(1),x=G(()=>({backgroundImage:e.currentBackground?`url(${e.currentBackground})`:"url(@/assets/images/default_bg.jpg)"}));r.value=!0;const b=u=>{console.log("Starfield ready",u)};return M(()=>e.currentBackgroundEffect,u=>{u==="Rain"&&(r.value=!0)}),(u,v)=>(_(),w(O,null,[t("div",{class:"game-background",style:ee(x.value)},null,4),a(e).currentBackgroundEffect==="StarField"?(_(),F(xe,{key:0,ref_key:"starfieldRef",ref:n,enabled:s.value,"star-count":o.value,"scroll-speed":p.value,colors:i.value,onReady:b},null,8,["enabled","star-count","scroll-speed","colors"])):K("",!0),a(e).currentBackgroundEffect==="Rain"?(_(),F(Ee,{key:1,enabled:g.value,intensity:k.value},null,8,["enabled","intensity"])):K("",!0)],64))}},Ve=D(Me,[["__scopeId","data-v-e1a99587"]]),De=["innerHTML"],Re=V({__name:"Icon",props:{icon:{type:String,default:"character"},size:{type:Number,default:18}},emits:["click"],setup(d,{emit:e}){const n=d,s=G(()=>o[n.icon]),o={character:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 20a6 6 0 0 0-12 0"/><circle cx="12" cy="10" r="4"/><circle cx="12" cy="12" r="10"/></svg>',text:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="21" y1="10" x2="3" y2="10"/><line x1="21" y1="6" x2="3" y2="6"/><line x1="21" y1="14" x2="3" y2="14"/><line x1="21" y1="18" x2="3" y2="18"/></svg>',background:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>',sound:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 10v3M6 7v9M10 4v15M14 7v9M18 10v3"/></svg>',history:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-history-icon lucide-history"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></svg>',box:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="5" x="2" y="4" rx="2"/><path d="M4 9v9a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9"/><path d="M10 13h4"/></svg>',play:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-play-icon lucide-play"><path d="M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z"/></svg>',save:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-marked-icon lucide-book-marked"><path d="M10 2v8l3-3 3 3V2"/><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20"/></svg>',advance:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="4" y1="21" y2="14" /><line x1="4" x2="4" y1="10" y2="3" /><line x1="12" x2="12" y1="21" y2="12" /><line x1="12" x2="12" y1="8" y2="3" /><line x1="20" x2="20" y1="21" y2="16" /><line x1="20"x2="20" y1="12" y2="3" /><line x1="2" x2="6" y1="14" y2="14" /><line x1="10" x2="14" y1="8" y2="8" /><line x1="18" x2="22" y1="16" y2="16" /></svg>',close:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',schedule:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard-list-icon lucide-clipboard-list"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></svg>'};return(p,i)=>(_(),w("span",{innerHTML:s.value,style:ee(`width:${d.size}px, height:${d.size}px`),onClick:i[0]||(i[0]=r=>p.$emit("click"))},null,12,De))}}),fe=D(Re,[["__scopeId","data-v-3908b06f"]]),Oe=["disabled"],ze=V({__name:"Button",props:{type:{},disabled:{type:Boolean},icon:{},icon_size:{}},emits:["click"],setup(d,{emit:e}){return(n,s)=>(_(),w("button",{class:z(n.type),disabled:n.disabled,onClick:s[0]||(s[0]=o=>n.$emit("click"))},[n.icon?(_(),F(fe,{key:0,icon:n.icon,size:n.icon_size},null,8,["icon","size"])):K("",!0),J(n.$slots,"default",{},void 0)],10,Oe))}}),I=D(ze,[["__scopeId","data-v-07752d7f"]]),Le={name:"GlassInput",inheritAttrs:!1,props:{modelValue:{type:String,default:""}},emits:["update:modelValue"]},je={class:"form-group"},Fe=["value"];function He(d,e,n,s,o,p){return _(),w("div",je,[t("input",we({type:"text",class:"form-control",value:n.modelValue,onInput:e[0]||(e[0]=i=>d.$emit("update:modelValue",i.target.value))},d.$attrs),null,16,Fe)])}const Ue=D(Le,[["render",He],["__scopeId","data-v-ea73f387"]]),Pe=["min","max","step","value"],Ge=V({__name:"Slider",props:{value:{type:Number,require:!1},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1}},emits:["change","input"],setup(d,{emit:e}){const n=d,s=m(),o=de();s.value=(n.min+n.max)/2;const p=G(()=>{if(o.default){const r=o.default();if(r&&r[0]&&typeof r[0].children=="string")return r[0].children.split("/")[0]||""}return""}),i=G(()=>{if(o.default){const r=o.default();if(r&&r[0]&&typeof r[0].children=="string")return r[0].children.split("/")[1]||""}return""});return(r,g)=>(_(),w("div",null,[t("span",null,[J(r.$slots,"left",{},()=>[B(S(p.value),1)])]),R(t("input",{type:"range",min:d.min,max:d.max,step:d.step,value:s.value,onInput:g[0]||(g[0]=k=>r.$emit("input",Number(s.value))),onChange:g[1]||(g[1]=k=>r.$emit("change",Number(s.value))),"onUpdate:modelValue":g[2]||(g[2]=k=>s.value=k)},null,40,Pe),[[ne,s.value]]),t("span",null,[J(r.$slots,"right",{},()=>[B(S(i.value),1)])])]))}}),ae=D(Ge,[["__scopeId","data-v-c3230732"]]),Ne={__name:"Text",props:{speed:{type:Number,default:0}},setup(d){const e=d,n=m(),s=de().default()[0].children;M(()=>e.speed,()=>p(e.speed));let o;const p=i=>{clearInterval(o),n.value="";let r=0;const g=200,x=g-(i-1)/99*(g-10);o=setInterval(()=>{r<s.length?(n.value+=s.charAt(r),r++):clearInterval(o)},x)};return(i,r)=>(_(),w("div",null,[t("p",null,S(n.value),1),r[0]||(r[0]=t("span",null,null,-1))]))}},We=D(Ne,[["__scopeId","data-v-79a954ed"]]),Ke=["id","checked"],qe=["for"],Je=V({__name:"Toggle",props:{checked:{type:Boolean,default:!1}},emits:["change"],setup(d,{emit:e}){const n=m(),s=m();return N(()=>{n.value=Math.random().toString(36).substring(2,9)}),(o,p)=>(_(),w("div",null,[R(t("input",{type:"checkbox",id:n.value,checked:d.checked,onChange:p[0]||(p[0]=i=>o.$emit("change",s.value)),"onUpdate:modelValue":p[1]||(p[1]=i=>s.value=i)},null,40,Ke),[[ke,s.value]]),t("label",{for:n.value},[J(o.$slots,"default",{},void 0)],8,qe)]))}}),Z=D(Je,[["__scopeId","data-v-2c12f9f5"]]);class Qe{element;timer=null;abortController;speed;isFinished;onFinishCallback;audioContext;soundBuffers;textBuffers;soundUrls;constructor(e){this.element=e,this.timer=null,this.abortController=null,this.speed=50,this.isFinished=!1,this.onFinishCallback=null,this.audioContext=null,this.soundBuffers=[],this.textBuffers="",this.soundUrls=["../audio_effects/å¯¹è¯.wav"]}async initAudio(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),await this.loadSounds()}catch(e){console.warn("éŸ³é¢‘åˆå§‹åŒ–å¤±è´¥:",e);const n=j();n.enableChatEffectSound=!1}}async loadSounds(){if(this.audioContext)try{const e=this.soundUrls.map(async n=>{const o=await(await fetch(n)).arrayBuffer();return this.audioContext.decodeAudioData(o)});this.soundBuffers=await Promise.all(e)}catch(e){console.warn("éŸ³æ•ˆåŠ è½½å¤±è´¥:",e)}}playRandomSound(){if(!j().enableChatEffectSound||!this.audioContext||this.soundBuffers.length===0)return;const n=this.soundBuffers[Math.floor(Math.random()*this.soundBuffers.length)],s=this.audioContext.createBufferSource();s.buffer=n,s.playbackRate.value=1;const o=this.audioContext.createGain();o.gain.value=.8,s.connect(o),o.connect(this.audioContext.destination),s.start()}setSoundEnabled(e){const n=j();n.enableChatEffectSound=e,e&&!this.audioContext&&this.initAudio()}async start(e,n){const s=j();this.stop(),this.isFinished=!1,n!==void 0?this.speed=Number.isInteger(n)?n:Number.parseInt(n.toString(),10)||50:(console.warn("é€Ÿåº¦å€¼æœªå®šä¹‰ï¼Œå°†é‡‡ç”¨é»˜è®¤é€Ÿåº¦ã€‚"),this.speed=50),this.abortController=new AbortController;let o=0;this.textBuffers="",s.enableChatEffectSound&&!this.audioContext&&await this.initAudio();const p=()=>{if(!this.abortController?.signal.aborted)if(o<e.length){this.textBuffers+=e.charAt(o),this.element.value=this.textBuffers,this.element.textContent=this.textBuffers,this.playRandomSound(),o++,this.element.scrollTop=this.element.scrollHeight;const i=this.speed*.8,r=this.speed*.4,g=i+Math.random()*r;this.timer=setTimeout(p,g)}else this.finish()};p()}finish(){this.stop(),this.isFinished=!0,this.element.style.borderRight="none",this.onFinishCallback&&this.onFinishCallback()}stop(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.abortController&&(this.abortController.abort(),this.abortController=null),this.isFinished=!1}checkFinished(){return this.isFinished}onFinish(e){this.onFinishCallback=e}}function Ye(d){const e=m(null),n=m(!1),s=()=>{d.value&&(e.value=new Qe(d.value))},o=async(i,r)=>{e.value||s(),n.value=!0,await e.value?.start(i,r),n.value=!1},p=()=>{e.value?.stop(),n.value=!1};return ue(()=>{p()}),{startTyping:o,stopTyping:p,isTyping:n}}const Xe={class:"chatbox-box"},Ze={class:"chatbox-main"},et={class:"chatbox-title-part"},tt={class:"chatbox-title"},at={id:"character"},nt={class:"chatbox-subtitle"},st={id:"character-sub"},ot={class:"chatbox-emotion"},lt={id:"character-emotion"},rt={class:"chatbox-inputbox"},it=["placeholder","onKeydown","readonly"],ct=["disabled"],ut=V({__name:"GameDialog",emits:["player-continued","dialog-proceed"],setup(d,{expose:e,emit:n}){const s=m(""),o=m(null),p=Y(),i=j(),{startTyping:r}=Ye(o),g=G(()=>p.currentStatus==="thinking"),k=n,x=()=>{i.toggleSettings(!0),i.setSettingsTab("history")},b=G(()=>{switch(p.currentStatus){case"input":return"åœ¨è¿™é‡Œè¾“å…¥æ¶ˆæ¯...";case"thinking":return p.avatar.think_message;case"responding":return"";default:return"åœ¨è¿™é‡Œè¾“å…¥æ¶ˆæ¯..."}}),u=G(()=>p.currentStatus==="input");M(()=>p.currentStatus,l=>{l==="thinking"?(p.avatar.emotion="AIæ€è€ƒ",i.showCharacterTitle=p.avatar.character_name,i.showCharacterSubtitle=p.avatar.character_subtitle):l==="input"&&(i.showCharacterTitle=p.avatar.user_name,i.showCharacterSubtitle=p.avatar.user_subtitle,i.showCharacterEmotion="")}),M([()=>i.showCharacterLine,()=>p.currentStatus],([l,C])=>{l&&l!==""&&C==="responding"?(s.value="",r(l,i.typeWriterSpeed)):l===""&&C==="input"&&(s.value="")});function v(){p.currentStatus==="input"?c():p.currentStatus==="responding"&&y(!0)}function c(){s.value.trim()&&($e.sendMessage(s.value),s.value="")}function y(l){const C=Se.continue();return C||(l&&k("player-continued"),k("dialog-proceed")),C}return e({continueDialog:y}),(l,C)=>(_(),w("div",Xe,[t("div",Ze,[t("div",et,[t("div",tt,[t("div",at,S(a(i).showCharacterTitle),1)]),t("div",nt,[t("div",st,S(a(i).showCharacterSubtitle),1)]),t("div",ot,[t("div",lt,S(a(i).showCharacterEmotion),1)]),f(a(I),{type:"nav",icon:"history",title:"",onClick:x})]),C[1]||(C[1]=t("div",{class:"chatbox-line"},null,-1)),t("div",rt,[R(t("textarea",{id:"inputMessage",ref_key:"textareaRef",ref:o,placeholder:b.value,"onUpdate:modelValue":C[0]||(C[0]=q=>s.value=q),onKeydown:ve(le(v,["exact","prevent"]),["enter"]),readonly:!u.value},null,40,it),[[ne,s.value]]),t("button",{id:"sendButton",disabled:g.value,onClick:v}," â–¼ ",8,ct)])])]))}}),dt={class:"main-box"},vt={id:"menu-panel"},mn=V({__name:"MainChat",setup(d){const e=j(),n=Y(),s=m(null),o=m(null),p=()=>{e.toggleSettings(!0),e.setSettingsTab("text")},i=()=>{e.autoMode=!e.autoMode},r=async()=>{try{await n.initializeGame("1"),s.value?s.value.setEmotion("æ­£å¸¸",!0):console.log("è¿™ä¸ªç»„ä»¶ä¸å­˜åœ¨")}catch(c){console.log(c)}};N(r),M(()=>n.avatar.character_id,(v,c)=>{v&&v!==c&&(console.log(`Character ID changed to ${v}, re-initializing...`),r())});let g=null;const k=m(!1),x=()=>{k.value=!1,g&&(clearTimeout(g),g=null)},b=()=>{if(e.autoMode){if(k.value){console.log("çˆ¶ç»„ä»¶ï¼šéŸ³é¢‘ç»“æŸäº†ï¼Œä½†ç”¨æˆ·å·²æ‰‹åŠ¨ç»§ç»­ï¼Œä¸åšä»»ä½•äº‹ã€‚");return}n.currentStatus==="responding"&&(g&&clearTimeout(g),g=setTimeout(()=>{o.value?o.value.continueDialog(!1)&&b():console.error("æ— æ³•æ‰¾åˆ° GameDialog çš„å®žä¾‹ã€‚")},1e3))}},u=()=>{console.log("ç”¨æˆ·ä¸»åŠ¨ç‚¹å‡»äº†"),g&&(clearTimeout(g),g=null,console.log("çˆ¶ç»„ä»¶ï¼šå·²å–æ¶ˆè‡ªåŠ¨ç»§ç»­çš„å®šæ—¶å™¨ã€‚")),k.value?console.log("çˆ¶ç»„ä»¶ï¼šç”¨æˆ·é‡å¤ç‚¹å‡»ï¼Œä½†æ–¹æ³•å·²æ‰§è¡Œè¿‡ï¼Œä¸å†è°ƒç”¨ã€‚"):k.value=!0};return(v,c)=>(_(),w("div",dt,[f(a(Ve)),f(a(Ie),{ref_key:"gameAvatarRef",ref:s,onAudioEnded:b},null,512),f(a(ut),{ref_key:"gameDialogRef",ref:o,onPlayerContinued:u,onDialogProceed:x},null,512),t("div",vt,[R(f(a(I),{type:"nav",icon:"play",onClick:i,class:z([{active:a(e).autoMode}])},{default:h(()=>c[0]||(c[0]=[t("h3",null,"è‡ªåŠ¨",-1)])),_:1,__:[0]},8,["class"]),[[H,a(e).showSettings!==!0]]),R(f(a(I),{type:"nav",icon:"text",onClick:p},{default:h(()=>c[1]||(c[1]=[t("h3",null,"èœå•",-1)])),_:1,__:[1]},512),[[H,a(e).showSettings!==!0]])])]))}}),ft=V({__name:"MenuItem",props:{title:{type:String,default:"é»˜è®¤æ ‡é¢˜"},size:{type:String,default:"large",validator:d=>["small","large"].includes(d)}},setup(d){return(e,n)=>(_(),w("section",{class:z(["menu-item",d.size])},[t("div",null,[t("h4",null,S(d.title),1)]),J(e.$slots,"default",{},void 0)],2))}}),T=D(ft,[["__scopeId","data-v-3d007fbc"]]),pt={},ht={class:"settings-page active"},_t={class:"settings-columns"};function mt(d,e){return _(),w("div",ht,[t("div",_t,[J(d.$slots,"default",{},void 0)])])}const Q=D(pt,[["render",mt],["__scopeId","data-v-b11651d0"]]),gt=async d=>{try{return await U.get("/v1/chat/history/list",{params:d})}catch(e){throw new Error(e.response?.data?.message||"èŽ·å–å­˜æ¡£åˆ—è¡¨å¤±è´¥")}},bt=async d=>{try{await U.post("/v1/chat/history/create",d)}catch(e){throw new Error(e.response?.data?.detail||"å­˜æ¡£åˆ›å»ºå¤±è´¥")}},yt=async d=>{try{return await U.get("/v1/chat/history/load",{params:d})}catch(e){throw new Error(e.response?.data?.detail||"å­˜æ¡£åŠ è½½å¤±è´¥")}},wt=async d=>{try{await U.post("/v1/chat/history/save",d)}catch(e){throw new Error(e.response?.data?.detail||"å­˜æ¡£ä¿å­˜å¤±è´¥")}},kt=async d=>{try{await U.post("/v1/chat/history/delete",d)}catch(e){throw new Error(e.response?.data?.detail||"å­˜æ¡£åˆ é™¤å¤±è´¥")}},$t=Ce("ui",{state:()=>({user_id:"1"}),actions:{}}),St={class:"new-save-form"},Ct={class:"save-section"},xt={class:"save-list-container"},At={key:0,class:"status-message"},Bt={key:1,class:"status-message error"},It={key:2,class:"status-message"},Tt={key:3,class:"save-list"},Et={class:"save-info"},Mt={class:"save-title"},Vt={class:"save-date"},Dt={class:"save-actions"},Rt=["onClick"],Ot=["onClick"],zt=["onClick"],X="1",Lt=V({__name:"SettingsSave",setup(d){const e=Y();$t();const n=m([]),s=m(""),o=m(!1),p=m(null),i=u=>{const v=new Date(u);return`${v.getFullYear()}.${v.getMonth()+1}.${v.getDate()}`},r=async()=>{o.value=!0,p.value=null;try{const u=await gt({user_id:X,page:1,page_size:10});n.value=u.conversations}catch(u){console.error("èŽ·å–å­˜æ¡£åˆ—è¡¨å¤±è´¥:",u),p.value=u.message||"æœªçŸ¥é”™è¯¯"}finally{o.value=!1}},g=async()=>{if(!s.value.trim()){alert("è¯·è¾“å…¥å­˜æ¡£åç§°ï¼");return}try{await bt({user_id:X,title:s.value.trim()}),s.value="",await r()}catch(u){console.error("åˆ›å»ºå­˜æ¡£å¤±è´¥:",u),alert(`åˆ›å»ºå¤±è´¥: ${u.message}`)}},k=async u=>{try{const v=await yt({user_id:X,conversation_id:u});alert(`å­˜æ¡£ [${u}] è¯»å–æˆåŠŸ!`),e.initializeGame(X)}catch(v){console.error("è¯»å–å­˜æ¡£å¤±è´¥:",v),alert(`è¯»å–å¤±è´¥: ${v.message}`)}},x=async u=>{try{await wt({user_id:X,conversation_id:u}),alert(`æˆåŠŸè¦†ç›–å­˜æ¡£ [${u}]!`),await r()}catch(v){console.error("ä¿å­˜æ¸¸æˆå¤±è´¥:",v),alert(`ä¿å­˜å¤±è´¥: ${v.message}`)}},b=async u=>{if(confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå­˜æ¡£å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚"))try{await kt({user_id:X,conversation_id:u}),await r()}catch(v){console.error("åˆ é™¤å­˜æ¡£å¤±è´¥:",v),alert(`åˆ é™¤å¤±è´¥: ${v.message}`)}};return N(()=>{r()}),(u,v)=>(_(),F(a(Q),null,{default:h(()=>[f(a(T),{title:"åˆ›å»ºæ–°å­˜æ¡£"},{default:h(()=>[t("div",St,[f(a(Ue),{type:"text",modelValue:s.value,"onUpdate:modelValue":v[0]||(v[0]=c=>s.value=c),placeholder:"è¾“å…¥å­˜æ¡£åç§°",onKeyup:ve(g,["enter"])},null,8,["modelValue"]),t("button",{class:"glass-effect action-btn-create",onClick:g}," åˆ›å»º ")])]),_:1}),f(a(T),{title:"å­˜æ¡£åˆ—è¡¨"},{default:h(()=>[t("div",Ct,[t("div",xt,[o.value?(_(),w("div",At,"åŠ è½½ä¸­...")):p.value?(_(),w("div",Bt," åŠ è½½å¤±è´¥: "+S(p.value),1)):n.value.length===0?(_(),w("div",It," æš‚æ— å­˜æ¡£è®°å½• ")):(_(),w("div",Tt,[(_(!0),w(O,null,W(n.value,c=>(_(),w("div",{key:c.id,class:"save-card glass-effect"},[t("div",Et,[t("span",Mt,S(c.title||"æœªå‘½åå­˜æ¡£"),1),t("span",Vt,S(i(c.updated_at)),1)]),t("div",Dt,[t("button",{onClick:y=>k(c.id),class:"glass-effect action-btn-load"}," è¯»å– ",8,Rt),t("button",{onClick:y=>x(c.id),class:"action-btn-save glass-effect"}," ä¿å­˜ ",8,Ot),t("button",{onClick:y=>b(c.id),class:"action-btn-delete glass-effect"}," åˆ é™¤ ",8,zt)])]))),128))]))])])]),_:1})]),_:1}))}}),jt=D(Lt,[["__scopeId","data-v-270f18d4"]]),Ft=V({__name:"SettingsText",setup(d){const e=m(),n=j(),s=i=>{e.value=i,n.typeWriterSpeed=i},o=i=>{console.log(i)},p=i=>{n.enableChatEffectSound=i};return(i,r)=>(_(),F(a(Q),null,{default:h(()=>[f(a(T),{title:"âš¡ æ–‡å­—æ˜¾ç¤ºé€Ÿåº¦"},{default:h(()=>[f(a(ae),{onChange:s},{default:h(()=>r[0]||(r[0]=[B("æ…¢/å¿«",-1)])),_:1,__:[0]})]),_:1}),f(a(T),{title:"ðŸ“ æ˜¾ç¤ºæ–‡å­—æ ·æœ¬"},{default:h(()=>[f(a(We),{speed:e.value},{default:h(()=>r[1]||(r[1]=[B("Ling Chat: æµ‹è¯•æ–‡æœ¬æ˜¾ç¤ºé€Ÿåº¦",-1)])),_:1,__:[1]},8,["speed"])]),_:1}),f(a(T),{title:"âœ¨ é¡µé¢åˆ‡æ¢åŠ¨ç”»",size:"small"},{default:h(()=>[f(a(Z),{onChange:o},{default:h(()=>r[2]||(r[2]=[B("å¯ç”¨åŠ¨ç”»æ•ˆæžœ",-1)])),_:1,__:[2]})]),_:1}),f(a(T),{title:"ðŸŒ è¯­éŸ³éŸ³æ•ˆå¼€å…³",size:"small"},{default:h(()=>[f(a(Z),{onChange:p},{default:h(()=>r[3]||(r[3]=[B("å¯ç”¨æ— vitsæ—¶çš„å¯¹è¯éŸ³æ•ˆ",-1)])),_:1,__:[3]})]),_:1}),f(a(T),{title:"âœ¨ WebSocketé€šä¿¡çŠ¶æ€",size:"small"},{default:h(()=>r[4]||(r[4]=[t("p",null,"âˆš è¿žæŽ¥æ­£å¸¸",-1)])),_:1,__:[4]}),f(a(T),{title:"âš™ å½“å‰ä½¿ç”¨çš„AIå¤§æ¨¡åž‹",size:"small"},{default:h(()=>r[5]||(r[5]=[t("p",null,"DeepSeek V3",-1)])),_:1,__:[5]})]),_:1}))}}),Ht=D(Ft,[["__scopeId","data-v-cac01c53"]]),Ut=async()=>{try{return await U.get("/v1/chat/back-music/list")}catch(d){throw new Error(d.response?.data?.message||"èŽ·å–éŸ³ä¹åˆ—è¡¨å¤±è´¥")}},Pt=async d=>{try{await U.post("/v1/chat/back-music/upload",d)}catch(e){throw new Error(e.response?.data?.detail||"å­˜æ¡£ä¸Šä¼ å¤±è´¥")}},Gt=async d=>{try{await U.delete("/v1/chat/back-music/delete",{params:{url:d}})}catch(e){throw new Error(e.response?.data?.detail||"å­˜æ¡£ä¸Šä¼ å¤±è´¥")}},Nt={class:"sound-test"},Wt={class:"music-controls"},Kt={class:"music-name"},qt={class:"music-list-container"},Jt={key:0,class:"empty-list"},Qt=["onClick"],Yt={class:"music-item-name"},Xt={class:"music-upload"},Zt=V({__name:"SettingsSound",setup(d){const e=j(),n=m(null),s=m(null),o=m(null),p=m([]),i=m("æœªé€‰æ‹©éŸ³ä¹"),r=m(!1),g=m(null),k=m(null),x=A=>{n.value&&(n.value.volume=A/100)},b=A=>{s.value&&(s.value.volume=A/100)},u=A=>{o.value&&(o.value.volume=A/100)};M(()=>e.backgroundVolume,A=>{o.value&&(o.value.volume=A/100)});const v=()=>{n.value&&(n.value.src="/audio_effects/è§’è‰²éŸ³é‡æµ‹è¯•.wav",n.value.play().catch(A=>console.error("æµ‹è¯•è§’è‰²éŸ³é‡æ’­æ”¾å¤±è´¥:",A)))},c=()=>{s.value&&(s.value.src="/audio_effects/ç–‘é—®.wav",s.value.play().catch(A=>console.error("æµ‹è¯•æ°”æ³¡éŸ³é‡æ’­æ”¾å¤±è´¥:",A)))},y=async()=>{p.value=await Ut()},l=async A=>{if(!A){console.log("musicå¯¹è±¡ä¸å­˜åœ¨");return}if(confirm(`ç¡®å®šè¦åˆ é™¤ã€Š${A.name}ã€‹å—ï¼Ÿ`))try{await Gt(A.url),console.log(`æ­£åœ¨åˆ é™¤éŸ³ä¹: ${A.url}`),alert(`ã€Š${A.name}ã€‹åˆ é™¤æˆåŠŸ`),await y()}catch($){console.error("åˆ é™¤éŸ³ä¹å¤±è´¥:",$),alert("åˆ é™¤éŸ³ä¹å¤±è´¥")}},C=async()=>{if(!g.value){alert("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªéŸ³ä¹æ–‡ä»¶");return}const A=g.value,$=[".mp3",".wav",".flac",".webm",".weba",".ogg",".m4a"],L=A.name.slice(A.name.lastIndexOf(".")).toLowerCase();if(!$.includes(L)){alert("ä¸æ”¯æŒçš„éŸ³é¢‘æ ¼å¼ã€‚è¯·ä¸Šä¼ : "+$.join(", "));return}const te=new FormData;te.append("file",A);try{await Pt(te),console.log(`æ­£åœ¨ä¸Šä¼ æ–‡ä»¶: ${A.name}`),alert("éŸ³ä¹ä¸Šä¼ æˆåŠŸ"),g.value=null,k.value&&(k.value.value=""),await y()}catch(be){console.error("ä¸Šä¼ éŸ³ä¹å¤±è´¥:",be),alert("éŸ³ä¹ä¸Šä¼ å¤±è´¥")}},q=G(()=>r.value?"â¸ æš‚åœ":"â–¶ æ’­æ”¾"),P=A=>{if(!o.value)return;const $=`/api/v1/chat/back-music/music_file/${encodeURIComponent(A.url)}`;o.value.src=$,o.value.play().catch(L=>console.error("æ’­æ”¾éŸ³ä¹å¤±è´¥:",L)),i.value=A.name,r.value=!0},re=()=>{o.value&&(r.value?o.value.pause():!o.value.src&&p.value.length>0?P(p.value[0]):o.value.play().catch(A=>console.error("æ¢å¤æ’­æ”¾å¤±è´¥:",A)),r.value=!o.value.paused)},pe=()=>{o.value&&(o.value.pause(),o.value.currentTime=0,r.value=!1)},he=()=>{k.value?.click()},_e=A=>{const $=A.target;$.files&&$.files.length>0?g.value=$.files[0]:g.value=null},me=()=>{o.value&&(r.value=!o.value.paused)},ge=()=>{r.value=!1};return N(()=>{y(),n.value&&(n.value.volume=e.characterVolume/100),s.value&&(s.value.volume=e.bubbleVolume/100),o.value&&(o.value.volume=e.backgroundVolume/100)}),(A,$)=>(_(),F(a(Q),null,{default:h(()=>[f(a(T),{title:"ðŸ‘© è§’è‰²éŸ³é‡",size:"small"},{default:h(()=>[f(a(ae),{modelValue:a(e).characterVolume,"onUpdate:modelValue":$[0]||($[0]=L=>a(e).characterVolume=L),onChange:x},{default:h(()=>$[3]||($[3]=[B(" å¼±/å¼º ",-1)])),_:1,__:[3]},8,["modelValue"])]),_:1}),f(a(T),{title:"ðŸ’¬ æ°”æ³¡éŸ³é‡",size:"small"},{default:h(()=>[f(a(ae),{onChange:b,modelValue:a(e).bubbleVolume,"onUpdate:modelValue":$[1]||($[1]=L=>a(e).bubbleVolume=L)},{default:h(()=>$[4]||($[4]=[B(" å¼±/å¼º ",-1)])),_:1,__:[4]},8,["modelValue"])]),_:1}),f(a(T),{title:"ðŸŽ¶ èƒŒæ™¯éŸ³é‡",size:"small"},{default:h(()=>[f(a(ae),{onChange:u,modelValue:a(e).backgroundVolume,"onUpdate:modelValue":$[2]||($[2]=L=>a(e).backgroundVolume=L)},{default:h(()=>$[5]||($[5]=[B(" å¼±/å¼º ",-1)])),_:1,__:[5]},8,["modelValue"])]),_:1}),f(a(T),{title:"ðŸ”Š å£°éŸ³æµ‹è¯•",size:"small"},{default:h(()=>[t("div",Nt,[f(a(I),{type:"big",onClick:v},{default:h(()=>$[6]||($[6]=[B("æµ‹è¯•è§’è‰²éŸ³é‡",-1)])),_:1,__:[6]}),f(a(I),{type:"big",onClick:c},{default:h(()=>$[7]||($[7]=[B("æµ‹è¯•æ°”æ³¡éŸ³é‡",-1)])),_:1,__:[7]})])]),_:1}),f(a(T),{title:"âš™ èƒŒæ™¯éŸ³ä¹è®¾ç½®"},{default:h(()=>[t("div",Wt,[f(a(I),{type:"big",onClick:re,class:"left-button"},{default:h(()=>[B(S(q.value),1)]),_:1}),f(a(I),{type:"big",onClick:pe,class:"left-button"},{default:h(()=>$[8]||($[8]=[B("â–  åœæ­¢",-1)])),_:1,__:[8]}),t("span",Kt,"å½“å‰: "+S(i.value),1)]),t("div",qt,[p.value.length===0?(_(),w("div",Jt," æš‚æ— éŸ³ä¹ï¼Œè¯·ä¸Šä¼  ")):K("",!0),(_(!0),w(O,null,W(p.value,L=>(_(),w("div",{key:L.url,class:"music-item",onClick:te=>P(L)},[t("div",Yt,S(L.name),1),f(a(I),{onClick:te=>l(L),class:"action-btn-delete glass-effect"},{default:h(()=>$[9]||($[9]=[B("åˆ é™¤",-1)])),_:2,__:[9]},1032,["onClick"])],8,Qt))),128))]),t("div",Xt,[f(a(I),{type:"big",onClick:he},{default:h(()=>$[10]||($[10]=[B("âž• æ·»åŠ éŸ³ä¹",-1)])),_:1,__:[10]}),t("input",{ref_key:"fileInput",ref:k,type:"file",onChange:_e,accept:".mp3,.wav,.flac,.webm,.weba,.ogg,.m4a",style:{display:"none"}},null,544),f(a(I),{type:"big",onClick:C,disabled:!g.value},{default:h(()=>$[11]||($[11]=[B("ç¡®è®¤ä¸Šä¼ ",-1)])),_:1,__:[11]},8,["disabled"])])]),_:1}),t("audio",{ref_key:"characterTestPlayer",ref:n},null,512),t("audio",{ref_key:"bubbleTestPlayer",ref:s},null,512),t("audio",{ref_key:"backgroundAudioPlayer",ref:o,loop:"",onTimeupdate:me,onEnded:ge},null,544)]),_:1}))}}),ea=D(Zt,[["__scopeId","data-v-74268141"]]),ta={class:"advanced-settings-box"},aa={class:"advanced-settings-grid"},na={key:0,class:"loader"},sa={class:"category-title"},oa=["onClick"],la={class:"advanced-content"},ra={key:0,class:"adv-content-page active"},ia={class:"advanced-settings-container"},ca={class:"adv-title"},ua={class:"adv-description"},da={class:"checkbox-label"},va=["id","checked","onChange"],fa={class:"description"},pa=["for"],ha={class:"description"},_a=["id","onUpdate:modelValue"],ma=["for"],ga={class:"description"},ba=["id","onUpdate:modelValue"],ya={class:"save-actions"},wa={key:1,class:"adv-content-page active"},ka=V({__name:"SettingsAdvance",setup(d){const e=m(!1),n=m({}),s=ie({category:null,subcategory:null}),o=ie({message:"",color:"var(--success-color)"}),p=m(null),i=m(null),r=G(()=>s.category&&s.subcategory?n.value[s.category]?.subcategories[s.subcategory]:null),g=(c,y)=>s.category===c&&s.subcategory===y,k=(c,y)=>{s.category=c,s.subcategory=y},x=(c,y)=>{c.value=y?"true":"false"},b=async()=>{if(!r.value)return;const c={};r.value.settings.forEach(y=>{c[y.key]=y.value}),e.value=!0,o.message="";try{const y=await fetch("/api/settings/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),l=await y.json();if(!y.ok)throw new Error(l.detail||"ä¿å­˜å¤±è´¥");o.message=l.message,o.color="var(--success-color)",await u(!1)}catch(y){o.message=`é”™è¯¯: ${y.message}`,o.color="red"}finally{e.value=!1,setTimeout(()=>{o.message=""},5e3)}},u=async(c=!0)=>{e.value=!0;try{const y=await fetch("/api/settings/config");if(!y.ok)throw new Error("æ— æ³•åŠ è½½é…ç½®");if(n.value=await y.json(),c&&Object.keys(n.value).length>0){const l=Object.keys(n.value)[0],C=Object.keys(n.value[l].subcategories)[0];l&&C&&k(l,C)}}catch(y){console.error(y),o.message=`åŠ è½½é…ç½®å¤±è´¥: ${y.message}`,o.color="red"}finally{e.value=!1}},v=()=>{if(!p.value||!i.value)return;const c=p.value.querySelector(".adv-nav-link.active");if(c){const y=c.offsetTop,l=c.offsetHeight;i.value.style.top=`${y}px`,i.value.style.height=`${l}px`}};return M(s,async()=>{await oe(),v()},{deep:!0}),N(async()=>{await u(),await oe(),v()}),(c,y)=>(_(),F(a(Q),null,{default:h(()=>[t("div",ta,[t("div",aa,[e.value?(_(),w("div",na,y[0]||(y[0]=[t("div",{class:"spinner"},null,-1)]))):K("",!0),t("nav",{ref_key:"navContainerRef",ref:p,class:"advanced-nav"},[t("div",{ref_key:"indicatorRef",ref:i,class:"adv-nav-indicator"},null,512),(_(!0),w(O,null,W(n.value,(l,C)=>(_(),w("div",{key:C,class:"adv-nav-category"},[t("span",sa,S(C),1),(_(!0),w(O,null,W(l.subcategories,(q,P)=>(_(),w("a",{key:P,href:"#",class:z(["adv-nav-link",{active:g(C,P.toString())}]),onClick:le(re=>k(C,P.toString()),["prevent"])},S(P),11,oa))),128))]))),128))],512),t("main",la,[r.value?(_(),w("div",ra,[t("div",ia,[t("header",null,[t("h2",ca,S(s.subcategory),1),t("p",ua,S(r.value.description||`ä¿®æ”¹ ${s.subcategory} çš„ç›¸å…³é…ç½®`),1)]),t("form",{class:"settings-form",onSubmit:le(b,["prevent"])},[(_(!0),w(O,null,W(r.value.settings,l=>(_(),w("div",{key:l.key,class:"form-group"},[l.type==="bool"?(_(),w(O,{key:0},[t("label",da,[t("input",{type:"checkbox",id:l.key,checked:l.value.toLowerCase()==="true",onChange:C=>x(l,C.target.checked)},null,40,va),B(" "+S(l.key),1)]),t("p",fa,S(l.description||""),1)],64)):l.type==="textarea"?(_(),w(O,{key:1},[t("label",{for:l.key},S(l.key),9,pa),t("p",ha,S(l.description||"æ”¯æŒå¤šè¡Œè¾“å…¥"),1),R(t("textarea",{id:l.key,"onUpdate:modelValue":C=>l.value=C,class:"form-control",rows:"8"},null,8,_a),[[ne,l.value]])],64)):(_(),w(O,{key:2},[t("label",{for:l.key},S(l.key),9,ma),t("p",ga,S(l.description||""),1),R(t("input",{type:"text",id:l.key,"onUpdate:modelValue":C=>l.value=C,class:"form-control"},null,8,ba),[[ne,l.value]])],64))]))),128))],32),t("div",ya,[t("button",{onClick:b},"ä¿å­˜"),t("p",{style:ee({color:o.color})},S(o.message),5)])])])):!e.value&&!Object.keys(n.value).length?(_(),w("div",wa,y[1]||(y[1]=[t("div",{class:"advanced-settings-container"},[t("header",null,[t("h2",{class:"adv-title"},"åŠ è½½å¤±è´¥"),t("p",{class:"adv-description"},"æ— æ³•åŠ è½½é…ç½®æˆ–é…ç½®ä¸ºç©ºã€‚")])],-1)]))):K("",!0)])])])]),_:1}))}}),$a=D(ka,[["__scopeId","data-v-04147be7"]]),Sa={class:"history-container"},Ca={key:0,class:"status-message"},xa={class:"message-item"},Aa={key:0,class:"player-message"},Ba={class:"name"},Ia={class:"content"},Ta=["title"],Ea={class:"name"},Ma={class:"content"},Va={key:0,class:"final-spacer"},Da=V({__name:"SettingsHistory",setup(d){const e=Y(),n=G(()=>e.dialogHistory),s=m(null);return M(n,()=>{s.value&&(s.value.scrollTop=s.value.scrollHeight)},{flush:"post",deep:!0}),(o,p)=>(_(),F(a(Q),null,{default:h(()=>[f(a(T),{title:"â—ˆ åŽ†å²å¯¹è¯"},{default:h(()=>[t("div",Sa,[n.value.length===0?(_(),w("div",Ca," æš‚æ— åŽ†å²è®°å½•ï¼ŒåŽ»å’ŒtaèŠèŠå¤©å­(*^â–½^*) ")):(_(),w("div",{key:1,class:"chat-history-container",ref_key:"chatContainer",ref:s},[(_(!0),w(O,null,W(n.value,(i,r)=>(_(),w(O,{key:i.timestamp||r},[t("div",xa,[i.type==="message"?(_(),w("div",Aa,[t("span",Ba,S(a(e).avatar.user_name)+": ",1),t("span",Ia,S(i.content),1)])):i.type==="reply"?(_(),w("div",{key:1,class:"ai-reply",title:`æƒ…ç»ª: ${i.originalTag}`},[t("span",Ea,S(a(e).avatar.character_name)+": ",1),t("span",Ma,[B(S(i.content)+" ",1),i.motionText?(_(),w(O,{key:0},[B("("+S(i.motionText)+")",1)],64)):K("",!0)])],8,Ta)):K("",!0)]),i.isFinal?(_(),w("div",Va)):K("",!0)],64))),128))],512))])]),_:1})]),_:1}))}}),Ra=D(Da,[["__scopeId","data-v-eae9bde5"]]),Oa=V({__name:"SettingsSchedule",setup(d){return(e,n)=>(_(),F(a(Q),null,{default:h(()=>[f(a(T),{title:"ä¸»åŠ¨æé†’",size:"small"},{default:h(()=>[f(a(Z),null,{default:h(()=>n[0]||(n[0]=[B("æ˜¯å¦å¼€å¯æ—¥ç¨‹ä¸»åŠ¨æé†’åŠŸèƒ½",-1)])),_:1,__:[0]})]),_:1}),f(a(T),{title:"éšæœºèŠå¤©",size:"small"},{default:h(()=>[f(a(Z),null,{default:h(()=>n[1]||(n[1]=[B("æ˜¯å¦å¼€å¯éšæœºé—´éš”ä¸»åŠ¨èŠå¤©åŠŸèƒ½",-1)])),_:1,__:[1]})]),_:1}),f(a(T),{title:"çª¥å±æƒé™",size:"small"},{default:h(()=>[f(a(Z),null,{default:h(()=>n[2]||(n[2]=[B("æ˜¯å¦å¼€å¯ä¸»åŠ¨çª¥å±èŠå¤©åŠŸèƒ½",-1)])),_:1,__:[2]})]),_:1}),f(a(T),{title:"æ—¥ç¨‹åˆ—è¡¨",size:"large"},{default:h(()=>n[3]||(n[3]=[B(" æ—¥ç¨‹ç»„ä»¶ ",-1)])),_:1,__:[3]})]),_:1}))}}),za={class:"character-card"},La={class:"character-avatar-container"},ja=["src","alt"],Fa={class:"character-content"},Ha={class:"character-title"},Ua={class:"character-description"},Pa={class:"character-actions"},Ga=V({__name:"CharacterCard",props:{avatar:{},name:{},info:{}},setup(d){return(e,n)=>(_(),w("div",za,[t("div",La,[t("img",{src:e.avatar,alt:e.name,class:"character-avatar"},null,8,ja)]),t("div",Fa,[t("h5",Ha,S(e.name),1),t("p",Ua,S(e.info),1),t("div",Pa,[J(e.$slots,"actions",{},void 0)])])]))}}),Na=D(Ga,[["__scopeId","data-v-1f2f7db6"]]),Wa={};function Ka(d,e){return _(),w("div",null,[J(d.$slots,"default",{},void 0)])}const qa=D(Wa,[["render",Ka],["__scopeId","data-v-0e08aff2"]]),Ja=async()=>{try{return await U.get("/v1/chat/character/get_all_characters")}catch(d){throw new Error(d.response?.data?.message||"èŽ·å–è§’è‰²åˆ—è¡¨å¤±è´¥")}},Qa=async d=>{try{return(await U.post("/v1/chat/character/select_character",d)).data}catch(e){throw new Error(e.response?.data?.detail||"è§’è‰²é€‰æ‹©å¤±è´¥")}},Ya={class:"character-list character-grid"},Xa=V({__name:"SettingsCharacter",setup(d){const e=m([]),n=m(1),s=Y(),o=async()=>{try{return(await Ja()).map(u=>({id:parseInt(u.character_id),title:u.title,info:u.info||"æš‚æ— è§’è‰²æè¿°",avatar:u.avatar_path?`/api/v1/chat/character/character_file/${encodeURIComponent(u.avatar_path)}`:"../pictures/characters/default.png"}))}catch(b){return console.error("èŽ·å–è§’è‰²åˆ—è¡¨å¤±è´¥:",b),[]}},p=async()=>{try{const b=await o();e.value=b}catch(b){console.error("åŠ è½½è§’è‰²å¤±è´¥:",b)}},i=async()=>{await s.initializeGame("1")},r=async b=>{try{await Qa({user_id:n.value.toString(),character_id:b.toString()}),i()}catch(u){console.error("åˆ‡æ¢è§’è‰²å¤±è´¥:",u)}},g=async()=>{try{const b=await fetch("/api/v1/chat/character/refresh_characters",{method:"POST",headers:{"Content-Type":"application/json"}});if(!b.ok)throw new Error(`HTTP error! status: ${b.status}`);await b.json(),alert("åˆ·æ–°æˆåŠŸ"),await p()}catch(b){alert("åˆ·æ–°å¤±è´¥"),console.error("åˆ·æ–°å¤±è´¥:",b)}},k=async()=>{try{const b=await fetch("/api/v1/chat/character/open_web");if(!b.ok)throw new Error(`HTTP error! status: ${b.status}`);await b.json()}catch(b){alert("å¯åŠ¨å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨åŽ»lingchatçš„discussionç½‘é¡µ"),console.error("æ‰“å¼€åˆ›æ„å·¥åŠå¤±è´¥:",b)}};function x(b){return s.avatar.character_id===b}return N(()=>{p()}),(b,u)=>(_(),F(a(Q),null,{default:h(()=>[f(a(T),{title:"è§’è‰²åˆ—è¡¨"},{default:h(()=>[f(qa,null,{default:h(()=>[t("div",Ya,[(_(!0),w(O,null,W(e.value,v=>(_(),F(Na,{key:v.id,avatar:v.avatar,name:v.title,info:v.info},{actions:h(()=>[f(a(I),{type:"select",class:z(["character-select-btn",{selected:x(v.id)}]),onClick:c=>r(v.id)},{default:h(()=>[B(S(x(v.id)?"âˆš é€‰ä¸­":"é€‰æ‹©"),1)]),_:2},1032,["class","onClick"])]),_:2},1032,["avatar","name","info"]))),128))])]),_:1})]),_:1}),f(a(T),{title:"åˆ·æ–°äººç‰©åˆ—è¡¨",size:"small"},{default:h(()=>[f(a(I),{type:"big",onClick:g},{default:h(()=>u[0]||(u[0]=[B("ç‚¹æˆ‘åˆ·æ–°~",-1)])),_:1,__:[0]})]),_:1}),f(a(T),{title:"åˆ›æ„å·¥åŠ",size:"small"},{default:h(()=>[f(a(I),{type:"big",onClick:k},{default:h(()=>u[1]||(u[1]=[B("è¿›å…¥åˆ›æ„å·¥åŠ",-1)])),_:1,__:[1]})]),_:1})]),_:1}))}}),Za=D(Xa,[["__scopeId","data-v-8b096622"]]),en=async()=>{try{return await U.get("/v1/chat/background/list",{})}catch(d){throw console.error("èŽ·å–æ¸¸æˆä¿¡æ¯é”™è¯¯:",d.message),d}},tn={class:"background-container"},an={class:"background-list character-grid"},nn={class:"background-image-container"},sn=["src","alt"],on=["data-title"],ln={class:"effect-list"},rn=V({__name:"SettingsBackground",setup(d){const e=m([]),n=m(""),s=m(null),o=j();N(async()=>{try{await i();const u=localStorage.getItem("selectedBackground");if(u)g(u);else if(e.value.length>0){const v=Math.floor(Math.random()*e.value.length);g(e.value[v].url),console.log("å·²é€‰éšæœºèƒŒæ™¯")}}catch(u){console.error("åŠ è½½èƒŒæ™¯å›¾ç‰‡å¤±è´¥",u)}});async function p(){try{return(await en()).map(v=>({title:v.title?v.title:"è‰æ³¥é©¬",url:v.url?`/api/v1/chat/background/background_file/${encodeURIComponent(v.url)}`:"../pictures/background/default.png",time:v.time}))}catch(u){return console.error("èŽ·å–èƒŒæ™¯åˆ—è¡¨å¤±è´¥:",u),[]}}async function i(){e.value=await p()}function r(u){return n.value===u}function g(u){n.value=u,o.currentBackground=u,localStorage.setItem("selectedBackground",u)}function k(){s.value&&s.value.click()}async function x(u){const v=u.target,c=v.files?.[0];if(!c)return;const y=c.name,l=y.slice(y.lastIndexOf(".")).toLowerCase(),C=[".jpg",".png",".webp",".bmp",".svg",".tif",".gif"];if(!C.includes(l)){alert("è¯·ä¸Šä¼ æ”¯æŒçš„å›¾ç‰‡æ ¼å¼: "+C.join(", "));return}const q=new FormData;q.append("file",c),q.append("name",y);try{if(!(await fetch("/api/v1/chat/background/upload",{method:"POST",body:q})).ok)throw new Error("ä¸Šä¼ å¤±è´¥");await i(),v&&(v.value="")}catch(P){console.error("ä¸Šä¼ å¤±è´¥",P),alert("ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•")}}function b(u){o.currentBackgroundEffect=u}return(u,v)=>(_(),F(a(Q),null,{default:h(()=>[f(a(T),{title:"èƒŒæ™¯é€‰æ‹©"},{default:h(()=>[t("div",tn,[t("div",an,[(_(!0),w(O,null,W(e.value,(c,y)=>(_(),w("div",{key:y,class:z(["background-card",{selected:r(c.url)}])},[t("div",nn,[t("img",{src:c.url,alt:c.title,class:"background-image"},null,8,sn)]),t("div",{class:"background-title","data-title":c.title},[f(a(I),{class:z(["background-select-btn",{selected:r(c.url)}]),onClick:l=>g(c.url)},{default:h(()=>[B(S(r(c.url)?"å·²é€‰ä¸­":"é€‰æ‹©"),1)]),_:2},1032,["class","onClick"])],8,on)],2))),128))]),f(a(I),{type:"big",onClick:k},{default:h(()=>v[2]||(v[2]=[B("ä¸Šä¼ è‡ªå®šä¹‰èƒŒæ™¯",-1)])),_:1,__:[2]}),t("input",{type:"file",ref_key:"uploadInput",ref:s,onChange:x,accept:".jpg,.png,.webp,.bmp,.svg,.tif,.gif",style:{display:"none"}},null,544)])]),_:1}),f(a(T),{title:"ç²’å­é€‰æ‹©",size:"large"},{default:h(()=>[t("div",ln,[f(a(I),{type:"big",onClick:v[0]||(v[0]=c=>b("StarField"))},{default:h(()=>v[3]||(v[3]=[B("æ˜Ÿç©º",-1)])),_:1,__:[3]}),f(a(I),{type:"big",onClick:v[1]||(v[1]=c=>b("Rain"))},{default:h(()=>v[4]||(v[4]=[B("é›¨æ°´",-1)])),_:1,__:[4]})])]),_:1})]),_:1}))}}),cn=D(rn,[["__scopeId","data-v-43f329d9"]]),un={class:"nav-container"},dn=V({__name:"SettingsNav",setup(d){const e=j(),n=m(null),s=m(null),o=m(null),p=m(null),i=m(null),r=m(null),g=m(null),k=m(null),x=m(null),b=(y,l)=>{e.setSettingsTab(y);const C={characterBtn:s,textBtn:o,backgroundBtn:p,soundBtn:i,historyBtn:r,saveBtn:g,advanceBtn:k,scheduleBtn:x}[l];C?.value?.$el&&u(C.value.$el)},u=y=>{!n.value||!y||(n.value.style.left=`${y.offsetLeft}px`,n.value.style.width=`${y.offsetWidth}px`)},v=()=>{const y=e.currentSettingsTab;let l=null;switch(y){case"character":l=s.value;break;case"text":l=o.value;break;case"background":l=p.value;break;case"sound":l=i.value;break;case"history":l=r.value;break;case"save":l=g.value;break;case"advance":l=k.value;break;case"schedule":l=x.value;break}l?.$el&&u(l.$el)};N(()=>{v()}),M(()=>e.currentSettingsTab,()=>{v()});const c=()=>{e.toggleSettings(!1)};return(y,l)=>(_(),w("div",un,[l[16]||(l[16]=t("img",{src:Ae,alt:"Logo",class:"settings-logo"},null,-1)),t("nav",null,[t("div",{ref_key:"indicator",ref:n,class:"nav-indicator"},null,512),f(a(I),{ref_key:"characterBtn",ref:s,type:"nav",icon:"character",onClick:l[0]||(l[0]=()=>b("character","characterBtn")),class:z({active:a(e).currentSettingsTab==="character"})},{default:h(()=>l[8]||(l[8]=[t("p",{class:"button-text"},"è§’è‰²",-1)])),_:1,__:[8]},8,["class"]),f(a(I),{ref_key:"textBtn",ref:o,type:"nav",icon:"text",onClick:l[1]||(l[1]=()=>b("text","textBtn")),class:z({active:a(e).currentSettingsTab==="text"})},{default:h(()=>l[9]||(l[9]=[t("p",{class:"button-text"},"æ–‡æœ¬",-1)])),_:1,__:[9]},8,["class"]),f(a(I),{ref_key:"backgroundBtn",ref:p,type:"nav",icon:"background",onClick:l[2]||(l[2]=()=>b("background","backgroundBtn")),class:z({active:a(e).currentSettingsTab==="background"})},{default:h(()=>l[10]||(l[10]=[t("p",{class:"button-text"},"èƒŒæ™¯",-1)])),_:1,__:[10]},8,["class"]),f(a(I),{ref_key:"soundBtn",ref:i,type:"nav",icon:"sound",onClick:l[3]||(l[3]=()=>b("sound","soundBtn")),class:z({active:a(e).currentSettingsTab==="sound"})},{default:h(()=>l[11]||(l[11]=[t("p",{class:"button-text"},"å£°éŸ³",-1)])),_:1,__:[11]},8,["class"]),f(a(I),{ref_key:"historyBtn",ref:r,type:"nav",icon:"history",onClick:l[4]||(l[4]=()=>b("history","historyBtn")),class:z({active:a(e).currentSettingsTab==="history"})},{default:h(()=>l[12]||(l[12]=[t("p",{class:"button-text"},"å¯¹è¯åŽ†å²",-1)])),_:1,__:[12]},8,["class"]),f(a(I),{ref_key:"saveBtn",ref:g,type:"nav",icon:"save",onClick:l[5]||(l[5]=()=>b("save","saveBtn")),class:z({active:a(e).currentSettingsTab==="save"})},{default:h(()=>l[13]||(l[13]=[t("p",{class:"button-text"},"å­˜æ¡£",-1)])),_:1,__:[13]},8,["class"]),f(a(I),{ref_key:"scheduleBtn",ref:x,type:"nav",icon:"schedule",onClick:l[6]||(l[6]=()=>b("schedule","scheduleBtn")),class:z({active:a(e).currentSettingsTab==="schedule"})},{default:h(()=>l[14]||(l[14]=[t("p",{class:"button-text"},"æ—¥ç¨‹",-1)])),_:1,__:[14]},8,["class"]),f(a(I),{ref_key:"advanceBtn",ref:k,type:"nav",icon:"advance",onClick:l[7]||(l[7]=()=>b("advance","advanceBtn")),class:z({active:a(e).currentSettingsTab==="advance"})},{default:h(()=>l[15]||(l[15]=[t("p",{class:"button-text"},"é«˜çº§è®¾ç½®",-1)])),_:1,__:[15]},8,["class"])]),f(fe,{icon:"close",class:"close-button",size:40,onClick:c})]))}}),vn={class:"settings-panel"},fn={class:"header"},pn={class:"container"},gn=V({__name:"SettingsPanel",setup(d){const e=j();return(n,s)=>(_(),w(O,null,[t("div",{class:"blur-overlay",style:ee({opacity:a(e).showSettings?1:0})},null,4),R(t("div",vn,[t("div",fn,[f(dn)]),t("div",pn,[R(f(a(jt),null,null,512),[[H,a(e).currentSettingsTab==="save"]]),R(f(a(Ht),null,null,512),[[H,a(e).currentSettingsTab==="text"]]),R(f(a(ea),null,null,512),[[H,a(e).currentSettingsTab==="sound"]]),R(f(a($a),null,null,512),[[H,a(e).currentSettingsTab==="advance"]]),R(f(a(Ra),null,null,512),[[H,a(e).currentSettingsTab==="history"]]),R(f(a(Oa),null,null,512),[[H,a(e).currentSettingsTab==="schedule"]]),R(f(a(Za),null,null,512),[[H,a(e).currentSettingsTab==="character"]]),R(f(a(cn),null,null,512),[[H,a(e).currentSettingsTab==="background"]])])],512),[[H,a(e).showSettings]])],64))}});export{mn as _,gn as a};
